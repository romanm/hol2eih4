# sql collection

sql.hol1.seekIcd10: \
SELECT icd_id, icd_code, icd_name FROM icd \
WHERE icd_name LIKE :seekIcd10 \
OR icd_code LIKE :seekIcd10Code \
LIMIT 10

sql.pgDbMaternityHol.history.monthYear: \
SELECT * FROM history, history_operation WHERE history_id=history_operation_id ${sql.pgDbMaternityHol.split.monthYear}

sql.pgDbMaternityHol.operation.distinctGroupCodenumber: \
SELECT DISTINCT ON (history_operation_group, history_operation_codenumber) \
history_operation_group, history_operation_codenumber, history_operation_code \
FROM history_operation

sql.pgDbMaternityHol.operation.groupCodenumber1: \
SELECT 'k'||history_operation_group history_operation_code , history_operation_group, 0 history_operation_codenumber, COUNT(history_operation_codenumber) FROM \
(SELECT * FROM history, history_operation WHERE history_id=history_operation_id \
AND date_part('month', history_out) >=1 AND DATE_PART('month', history_out) <=12 AND DATE_PART('year', history_out) =2016) x \
GROUP BY history_operation_group

sql.pgDbMaternityHol.operation.groupCodenumber: \
SELECT history_operation_code, x.* \
FROM (SELECT history_operation_group, history_operation_codenumber, COUNT(history_operation_codenumber) \
FROM (${sql.pgDbMaternityHol.history.monthYear}) x \
GROUP BY history_operation_group, history_operation_codenumber \
ORDER BY history_operation_group, history_operation_codenumber) x, \
(${sql.pgDbMaternityHol.operation.distinctGroupCodenumber}) y \
WHERE x.history_operation_group=y.history_operation_group AND x.history_operation_codenumber=y.history_operation_codenumber


sql.pgDbMaternityHol.split.monthYear: \
AND date_part('month', history_out) >=:min_month AND date_part('month', history_out) <=:max_month AND date_part('year', history_out) =:year

sql.pgDbMaternityHol.monthYear.operation: \
SELECT * FROM ( \
SELECT history_operation_code, x.* FROM \
(SELECT history_operation_group, history_operation_codenumber, COUNT(history_operation_codenumber)  \
FROM (SELECT * FROM history, history_operation WHERE history_id=history_operation_id \
${sql.pgDbMaternityHol.split.monthYear}) x \
GROUP BY history_operation_group, history_operation_codenumber \
) x, \
(SELECT distinct on (history_operation_group, history_operation_codenumber) history_operation_group, history_operation_codenumber, history_operation_code \
FROM history_operation ho) y \
WHERE x.history_operation_group=y.history_operation_group AND x.history_operation_codenumber=y.history_operation_codenumber \
UNION \
SELECT 'k11' history_operation_code , 11 history_operation_group, 0 history_operation_codenumber, COUNT(*)  FROM \
(SELECT * FROM history, history_operation WHERE history_id=history_operation_id \
${sql.pgDbMaternityHol.split.monthYear}) x \
UNION \
SELECT 'k'||history_operation_group history_operation_code , history_operation_group, 0 history_operation_codenumber, COUNT(history_operation_codenumber)  \
FROM (SELECT * FROM history, history_operation WHERE history_id=history_operation_id \
${sql.pgDbMaternityHol.split.monthYear}) x \
GROUP BY history_operation_group \
) x2 \
ORDER BY history_operation_group, history_operation_codenumber

sql.pgDbMaternityHol.monthYear.operation3: \
SELECT * FROM (${sql.pgDbMaternityHol.operation.groupCodenumber} \
UNION \
${sql.pgDbMaternityHol.operation.groupCodenumber}
) x \
ORDER BY history_operation_group, history_operation_codenumber

sql.pgDbMaternityHol.monthYear.operation2: \
SELECT history_operation_code, hog.* FROM ( \
SELECT * FROM ( \
SELECT history_operation_group, history_operation_codenumber, COUNT(history_operation_codenumber) \
FROM (${sql.pgDbMaternityHol.history.monthYear}) x GROUP BY history_operation_group, history_operation_codenumber \
UNION \
SELECT history_operation_group, 99999, COUNT(history_operation_group) \
FROM (${sql.pgDbMaternityHol.history.monthYear}) x GROUP BY history_operation_group \
) hog ORDER BY history_operation_group, history_operation_codenumber \
) hog, history_operation ho_code \
WHERE ho_code.history_operation_group=hog.history_operation_group \
AND ho_code.history_operation_codenumber=hog.history_operation_codenumber

sql.pgDbMaternityHol.monthYear.diagnose: \
SELECT * FROM ( \
SELECT history_diagnose_icd_code, COUNT(history_diagnose_icd_code) cnt_icd_code \
FROM history_diagnose hd, history h \
WHERE h.history_id=history_diagnose_id \
${sql.pgDbMaternityHol.split.monthYear} \
GROUP BY history_diagnose_icd_code) x \
ORDER BY cnt_icd_code DESC, history_diagnose_icd_code

sql.pgDbMaternityHol.icdMonth: \
SELECT s.*, c.icd_name FROM( \
SELECT * FROM( \
SELECT iall.* code, imn.cnt FROM \
	(SELECT ICD_CODE \
		FROM dity1.ix ix, list.icd icd \
		WHERE ix.ICD_CODE1=ICD_CODE \
		GROUP BY ICD_CODE ) iall \
	LEFT JOIN \
	(SELECT ICD_CODE, count(ICD_CODE) cnt FROM \
		(SELECT * FROM dity1.ix \
		WHERE date_part('month', ix_out)  >= :min_month \
			AND date_part('month', ix_out)  <= :max_month ) ix, list.icd icd \
	WHERE ix.ICD_CODE1=ICD_CODE \
 GROUP BY ICD_CODE ) imn ON iall.icd_code=imn.icd_code ) s1 \
 UNION \
 SELECT 'zall', count(*) FROM dity1.ix \
	WHERE date_part('month',ix_out)  >= :min_month \
		AND date_part('month',ix_out)  <= :max_month \
) s LEFT JOIN list.icd c ON c.icd_code=s.icd_code \
ORDER BY icd_code 

# hol1Eih

#EIX
sql.hol1.eix.historyPatient: \
SELECT * FROM history h, patient p, direct d, department dp \
WHERE d.direct_id=h.direct_id \
AND dp.department_id=h.history_department_id \
AND p.patient_id=h.patient_id AND h.history_id=:eixId

sql.hol1.eix.operation_history: \
SELECT * FROM operation_history oh, operation o \
WHERE history_id=:eixId \
AND o.operation_id=oh.operation_id

sql.hol1.eix.personal_personal_department: \
SELECT personal_department_id, concat(personal_surname,' ',personal_name,' ',personal_patronymic) name \
FROM personal_department pd, personal p \
WHERE p.personal_id=pd.personal_id \

sql.hol1.eix.department_history: \
SELECT pd_in.name p_in ,pd_out.name p_out , dh.*  \
FROM department_history dh \
LEFT JOIN ( ${sql.hol1.eix.personal_personal_department} ) pd_in ON pd_in.personal_department_id=dh.personal_department_id_in  \
LEFT JOIN ( ${sql.hol1.eix.personal_personal_department} ) pd_out ON pd_out.personal_department_id=dh.personal_department_id_out \
WHERE dh.history_id=:eixId

sql.hol1.eix.history_diagnose: \
SELECT * FROM history_diagnos hd, icd icd \
WHERE hd.history_id=:eixId \
AND icd.icd_id=hd.icd_id

sql.hol1.eix.history_treatment_analysis: \
SELECT * FROM history_treatment_analysis hta, treatment_analysis ta \
WHERE history_id=:eixId \
AND ta.treatment_analysis_id=hta.treatment_analysis_id

sql.hol1.update.history_treatment_analysis_text: \
UPDATE history_treatment_analysis \
SET history_treatment_analysis_text = :history_treatment_analysis_text \
WHERE history_treatment_analysis_id = :history_treatment_analysis_id

#EIX END

# Рух хворих лікарні на цей день
sql.hol1.f007.spital: \
SELECT department_name, dh.department_id \
, SUM(onBeginDay) c5 \
, SUM(!onBeginDay AND fromReception) c6 \
, SUM(!onBeginDay AND !fromReception) c9 \
/*, SUM(!onEndDay AND !dead AND !outClinicFromDepartment) c10 \
, SUM(!onEndDay AND dead) c13 \
*/ \
, SUM(!onEndDay AND !outClinicFromDepartment) c10 \
, SUM(!onEndDay AND !dead AND outClinicFromDepartment) c11 \
, SUM(!onEndDay AND outClinicFromDepartment AND dead) c13 \
, SUM(onEndDay) c14 \
/* , ' ', dh.* */ \
FROM ( ${sql.hol1.f007.daySpitalPatients} \
) dh, department d  LEFT JOIN department_sort ds ON d.department_id=ds.department_sort_id \
WHERE dh.department_id=d.department_id \
GROUP BY dh.department_id \
ORDER BY department_sort_sort_ruh

# Рух хворих лікарні на цей день v.02
sql.hol1.f007.daySpitalPatients: \
SELECT * FROM ( \
SELECT \
dh.department_history_in < dayEnd AND (dh.department_history_out >= dayBegin OR dh.department_history_out is null) \
wereInDepartmentThisDay \
, dh.department_history_in < dayBegin AND (dh.department_history_out >= dayBegin OR dh.department_history_out is null) \
onBeginDay \
, dh.department_history_in=h.history_in \
fromReception \
, dh.department_history_in < dayEnd AND (dh.department_history_out >= dayEnd OR dh.department_history_out is null) \
onEndDay \
, result_id=5 dead \
, dh.department_history_out=h.history_out \
outClinicFromDepartment \
, to_dh.department_id to_department_id \
, from_dh.department_id from_department_id \
, thisDay.* \
, dh.* \
FROM \
( SELECT dayBegin, dayBegin + INTERVAL 1 day dayEnd \
FROM (SELECT timestamp(concat(:yyyy, '-', :mm, '-', :dd, ' 09:00:00')) dayBegin) x ) thisDay \
, department_history dh \
LEFT JOIN history h ON h.history_id=dh.history_id \
LEFT JOIN department_history to_dh \
ON TIMESTAMPDIFF(SECOND, dh.department_history_out, to_dh.department_history_in) = 1 and dh.history_id = to_dh.history_id \
LEFT JOIN department_history from_dh \
ON TIMESTAMPDIFF(SECOND, from_dh.department_history_out, dh.department_history_in) = 1 and from_dh.history_id = dh.history_id \
) dh \
WHERE wereInDepartmentThisDay \
/* ORDER BY onBeginDay, onEndDay \
ORDER BY onEndDay, dead desc  */ 

# hol1Eih РУХ f007, f016, f20t3100
sql.hol1.ruh.f007Spital: \
SELECT \
	calcDay.department_id, \
	department_name, \
	sum(in_this_day) in_this_day, \
	sum(in_inner) in_inner, \
	sum(out_inner) out_inner, \
	sum(out_this_day11) out_this_day11 , \
	sum(dead_this_day13) dead_this_day13 , \
	state_begin_day, \
	count(state_end_day) state_end_day \
	/* , dayBegin, beforeDayBegin , calcDay.* */ \
FROM ( ${sql.hol1.ruh.f007.daySpitalPatients} ) calcDay \
		LEFT JOIN ( /* було на кінець попереднього дня */ \
			SELECT department_id, count(state_begin_day) state_begin_day \
			FROM ( ${sql.hol1.ruh.f007.departmentHistoryForDay} ) beforeCalcDay \
			WHERE in_before_beforeDayEnd and out_after_beforeDayBegin \
			GROUP BY department_id \
		) beforeCalcDay ON calcDay.department_id=beforeCalcDay.department_id \
		LEFT JOIN \
		( SELECT department_id, department_name, department_sort_sort_ruh \
			FROM department_sort ds, department d \
			WHERE d.department_id=ds.department_sort_id \
		) d \
	ON calcDay.department_id=d.department_id \
	GROUP BY calcDay.department_id \
	ORDER BY department_sort_sort_ruh

# Рух хворих лікарні на цей день v.01
sql.hol1.ruh.f007.daySpitalPatients: \
SELECT state_end_day, dhThisDay.department_id, \
		dhThisDay.history_id, \
		dhThisDay.department_history_in, \
		dhThisDay.department_history_out, \
		dhThisDay.department_history_in >= dayBegin in_this_day, \
		dhThisDay.department_history_out >= dayBegin \
		AND dhThisDay.department_history_out < dayEnd \
		AND dhThisDay.department_history_out = h.history_out \
		 AND h.result_id!=5 out_this_day11, \
		dhThisDay.department_history_out = h.history_out \
		AND dhThisDay.department_history_out >= dayBegin \
		AND dhThisDay.department_history_out < dayEnd AND h.result_id=5 dead_this_day13, \
		dhThisDay.department_history_in < dayEnd in_before, \
		dh_to.department_history_in dh_to_ts, \
		dh_from.department_history_id is not null in_inner, \
		dh_to.department_history_id is not null out_inner, \
		dh_from.department_history_out dh_from_ts \
		/* , '.', dhThisDay.* */ \
FROM ( ${sql.hol1.ruh.f007.departmentHistoryForDay} ) dhThisDay  \
LEFT JOIN history h ON dhThisDay.history_id=h.history_id \
LEFT JOIN department_history dh_from \
	ON dhThisDay.department_history_in - dh_from.department_history_out =1 AND dhThisDay.history_id=dh_from.history_id  \
LEFT JOIN department_history dh_to  \
	ON dh_to.department_history_in - dhThisDay.department_history_out =1 AND dhThisDay.history_id=dh_to.history_id  \
WHERE in_before_dayEnd AND out_after_dayBegin 

# часові інтервали f007 початок і кінець цього дня і початок попереднього дня
sql.hol1.ruh.f007.dayIntervals: \
SELECT dayBegin - INTERVAL 1 day beforeDayBegin, dayBegin, dayBegin + INTERVAL 1 day dayEnd \
FROM (SELECT timestamp(concat(:yyyy, '-', :mm, '-', :dd, ' 09:00:00')) dayBegin) x

# Весь рух по лікарні з відзнакою цього дня
sql.hol1.ruh.f007.departmentHistoryForDay: \
SELECT \
	( department_history_out >= thisDay.dayBegin OR department_history_out IS NULL ) \
	AND department_history_in < thisDay.dayBegin state_begin_day, \
	(department_history_out >= thisDay.dayEnd  OR department_history_out IS NULL) \
	AND department_history_in < dayEnd state_end_day, \
	department_history_in < thisDay.dayEnd in_before_dayEnd /* поступили до кінця дня */ \
	, department_history_out >= thisDay.dayBegin OR department_history_out IS NULL  out_after_dayBegin /* виписані з початку дня */ \
	, department_history_in < thisDay.dayBegin in_before_beforeDayEnd /* поступили до кінця попереднього дня */ \
	/* , department_history_out >= thisDay.beforeDayBegin OR department_history_out IS NULL */ \
	, department_history_out >= thisDay.dayBegin OR department_history_out IS NULL \
	out_after_beforeDayBegin  /* виписані з початку попереднього дня */ \
	, dh.*, thisDay.*\
FROM department_history dh, ( ${sql.hol1.ruh.f007.dayIntervals} ) thisDay

# Всі хворі відділення на цей день v.02
sql.hol1.f007s2.dayDepartment: \
SELECT p.patient_surname, p.patient_name, p.patient_patronnymic, h.history_no,  dhThisDay.* \
FROM ( ${sql.hol1.f007.daySpitalPatients} ) dhThisDay, history h, patient p \
WHERE dhThisDay.department_id=:departmentId \
AND dhThisDay.history_id=h.history_id AND p.patient_id=h.patient_id \
ORDER BY p.patient_surname

# Всі хворі відділення на цей день v.01
sql.hol1.ruh.f007s2.dayDepartmentPatients: \
SELECT p.patient_surname, p.patient_name, p.patient_patronnymic, h.history_no,  dhThisDay.* \
FROM ( ${sql.hol1.ruh.f007.daySpitalPatients} ) \
dhThisDay, history h, patient p \
WHERE dhThisDay.department_id=:departmentId \
AND dhThisDay.history_id=h.history_id AND p.patient_id=h.patient_id
ORDER BY p.patient_surname

# Рух хворих відділення на цей день v.02
sql.hol1.f007s1.dayDepartment: \
SELECT * FROM ( ${sql.hol1.f007.spital} ) x \
WHERE department_id=:departmentId

# Рух хворих відділення на цей день v.01
sql.hol1.ruh.f007s1.dayDepartmentPatients: \
SELECT * FROM ( ${sql.hol1.ruh.f007Spital} ) x \
WHERE department_id=:departmentId

# hol1Eih РУХ f007, f016, f20t3100 END

#hol1Eih ліжко-дні
sql.hol1.bed_day_all_department: \
SELECT d.*, \
		round(if(d.dead IS NULL, 0, d.dead/TREAT*100),2) mortality, \
		round(bed_day * 100 / bed_day_plan,2) bed_day_fulfil, \
		round(bed_day  / department_bed,2)  bed_occupancy, \
		round(bed_day  / TREAT,1) treat_avg, \
		round((bed_day  / department_bed)/( bed_day / TREAT ),2)  bed_turnover, \
		round((d.in_clinic+ifnull(d.dead,0))/d.department_bed,2)  bed_turnover2 \
 FROM (SELECT d.*, round((d.in_clinic+ifnull(d.in_dep,0)+d.out_clinic+ifnull(d.out_dep,0)+ifnull(d.dead,0))/2) TREAT \
	FROM (SELECT d.department_id dp_id, \
			  d.department_name, \
			  d.department_bed, \
			  if(d.department_id=14,310,340) bd_key, \
			  bed_day_plan, \
			  in_clinic.in_clinic, \
			  in_dep.in_dep, \
			  out_clinic.out_clinic, \
			  out_dep.out_dep, \
			  out_to_clinic.out_to_clinic, \
			  dead.dead, \
			  bed_day.bed_day \
	   FROM (/* відділення + розгорнуті ліжка + план ліжкоднів */ \
			 SELECT department_id, \
					department_name, \
					department_bed, \
					sum(bed_day_plan) bed_day_plan \
			 FROM (/* bed_day_plan */ \
				   SELECT *, round(bd_key/366*month_days*department_bed) bed_day_plan \
				   FROM (/* відділення з ліжкоднями */ \
						 SELECT d.department_id, \
		department_bed, \
		d.department_name, \
		if(d.department_id=14,310,if(d.department_id=23 or d.department_id=10,290,340)) bd_key \
 FROM department_bed db1, department d, \
   (SELECT max(department_bed_id) department_bed_id \
	FROM department_bed \
	GROUP BY department_id) db2 \
 WHERE db1.department_bed_id=db2.department_bed_id \
   AND d.department_id=db1.department_id) department_bed, \
						(/* днів в місяці */ \
						 SELECT max(day(daydate)) month_days \
						 FROM every_day \
						 WHERE month(daydate)  >= :min_month \
						   AND month(daydate)  >= :max_month \
						   AND year(daydate) = 2016 \
						 GROUP BY month(daydate)) month_days) bed_day_plan \
			 GROUP BY department_id ) d \
	   LEFT JOIN (/* поступивші в лікарню */ \
				  SELECT history_department_in, count(history_department_in) in_clinic \
				  FROM history \
				  WHERE month(history_in)  >= :min_month \
					AND month(history_in)  >= :max_month \
					AND year(history_in)  =  :year \
				  GROUP BY history_department_in) in_clinic ON in_clinic.history_department_in=d.department_id \
	   LEFT JOIN (/* переведені з інши відділення */ \
				  SELECT dh.department_id, \
						 count(dh.department_id) in_dep \
				  FROM \
					(SELECT dh.* \
					 FROM department_history dh, \
						  history h \
					 WHERE h.history_id=dh.history_id \
					   AND h.history_department_in != dh.department_id) dh \
				  WHERE month(dh.department_history_in)  >= :min_month \
					AND month(dh.department_history_in)  >= :max_month \
					AND year(dh.department_history_in)  =  :year \
				  GROUP BY dh.department_id) in_dep ON in_dep.department_id=d.department_id \
	   LEFT JOIN (/* виписані з лікарні */ \
				  SELECT history_department_out, count(history_department_out) out_clinic \
				  FROM history \
				  WHERE month(history_out) >= :min_month \
					AND month(history_out) >= :max_month \
					AND year(history_out)  =  :year \
				  GROUP BY history_department_out) out_clinic ON out_clinic.history_department_out=d.department_id \
	   LEFT JOIN (/* переведені в інші відділення */ \
				  SELECT dh.department_id, count(dh.department_id) out_dep \
				  FROM (SELECT dh.* \
					 FROM department_history dh,  history h \
					 WHERE h.history_id=dh.history_id \
					   AND h.history_department_out != dh.department_id) dh \
				  WHERE month(dh.department_history_out) >= :min_month \
					AND month(dh.department_history_out) >= :max_month \
					AND year(dh.department_history_out)  =  :year \
				  GROUP BY dh.department_id) out_dep ON out_dep.department_id=d.department_id \
	   LEFT JOIN (/* переведені в іншу лікарню */ \
				  SELECT history_department_out, \
						 count(history_department_out) out_to_clinic \
				  FROM history h \
				  WHERE result_id=6 \
					AND month(history_out) >= :min_month \
					AND month(history_out) >= :max_month \
					AND year(history_out)  =  :year \
				  GROUP BY history_department_out) out_to_clinic ON out_to_clinic.history_department_out=d.department_id \
	   LEFT JOIN (/* померло */ \
				  SELECT history_department_out, \
						 count(history_department_out) dead \
				  FROM history \
				  WHERE month(history_out) >= :min_month \
					AND month(history_out) >= :max_month \
					AND year(history_out)  =  :year \
					AND result_id=5 \
				  GROUP BY history_department_out) dead ON dead.history_department_out=d.department_id \
	   LEFT JOIN (/* ліжкодні (сумма лікувались кожного дня) */ \
				  SELECT department_id, \
						 sum(TREAT) bed_day \
				  FROM (/* лікувальсь в день */ \
						SELECT department_id, \
							   daydate, \
							   count(daydate) TREAT \
						FROM department_history dh, (SELECT * \
						   FROM every_day \
						   WHERE month(daydate)  >= :min_month \
							 AND month(daydate)  >= :max_month \
							 AND year(daydate) = 2016) daydate \
						WHERE daydate>=dh.department_history_in \
						  AND daydate<=dh.department_history_out \
						GROUP BY department_id, \
								 daydate) treat_of_day \
				  GROUP BY department_id) bed_day ON bed_day.department_id=d.department_id) d)d \
 UNION \
 SELECT *  \
 FROM  (SELECT 0 dp_id, \
		   'Всього:' department_name, \
					 0 d_bed, \
					 0 d_bed_plan, \
					 0 max_moth_day ) all_, \
   (SELECT count(history_department_in) _in \
	FROM history \
	WHERE month(history_in) >= :min_month \
	  AND month(history_in) >= :max_month \
	  AND year(history_in)  =  :year ) in_, \
   (SELECT 0 in_dep) in_dep, \
   (SELECT count(history_department_out) _out \
	FROM history \
	WHERE month(history_out) >= :min_month \
	  AND month(history_out) >= :max_month \
	  AND year(history_out)  =  :year ) out_, \
   (SELECT 0 out_dep) out_dep, \
   (SELECT 0 out_to_clinic) out_to_clinic, \
   (SELECT count(history_department_out) dead, \
	  (SELECT 0 l) bed_day, \
	  (SELECT 0 l) TREAT, \
	  (SELECT 0 l) mortality, \
	  0 bed_day_fulfil, \
 0	 bed_occupancy, \
 0	 treat_avg, \
 0	 bed_turnover, \
 0	 bed_turnover2 \
	FROM history \
	WHERE month(history_out) >= :min_month \
	  AND month(history_out) >= :max_month \
	  AND year(history_out)  =  :year \
	  AND result_id=5) dead 

#hol1Eih ліжко-дні END


# hol1Eih adress
sql.hol1.countries: SELECT * FROM country
sql.hol1.district.of.country: SELECT * FROM district where country_id=:countryId
sql.hol1.region.of.district: SELECT * FROM region where district_id=:districtId
sql.hol1.locality.of.region: SELECT * FROM locality where region_id=:regionId
sql.hol1.cnt.patient.of.country: SELECT count(*) cnt FROM country where country_id=:countryId
sql.hol1.cnt.patient.of.district: SELECT count(*) cnt FROM district where district_id=:districtId
sql.hol1.cnt.patient.of.country: SELECT count(*) cnt FROM country where country_id=:countryId
sql.hol1.cnt.patient.of.region: SELECT count(*) cnt FROM patient where region_id=:regionId
sql.hol1.cnt.patient.of.locality: SELECT count(*) cnt FROM patient where locality_id=:localityId
sql.hol1.cnt.patient.update.adress4: \
UPDATE patient SET country_id=:country2Id, district_id=:district2Id, region_id=:region2Id, locality_id=:locality2Id \
WHERE country_id=:country1Id AND district_id=:district1Id AND region_id=:region1Id AND locality_id=:locality1Id

# hol1Eih adress END

# hol1Eih icd

sql.hol1.icd.rootsibling: SELECT t.*,icd_code,icd_name FROM icd10uatree t, icd i WHERE i.icd_id=icd10uatree_id AND icd10uatree_parent_id = icd10uatree_id;
sql.hol1.icd.self:SELECT t.*,icd_code,icd_name FROM icd10uatree t, icd i \
WHERE i.icd_id=icd10uatree_id AND icd10uatree_id = :icdId;

sql.hol1.icd.sibling:SELECT t2.cnt, t.*, icd_code, icd_name FROM icd10uatree t \
LEFT JOIN ( SELECT icd10uatree_parent_id, COUNT(icd10uatree_parent_id) cnt \
		FROM icd10uatree \
		GROUP BY icd10uatree_parent_id) t2 \
		ON t.icd10uatree_id = t2.icd10uatree_parent_id , icd i \
WHERE i.icd_id=t.icd10uatree_id AND t.icd10uatree_parent_id != t.icd10uatree_id AND t.icd10uatree_parent_id = :parentId;

sql.hol1.icd.all: SELECT * FROM icd order by icd_root, icd_left_key

sql.hol1.icd.seek:SELECT icd_id, cnt, icd_code, icd_name FROM ( \
SELECT distinct i2.icd_id uid, -1 cnt, i2.* FROM icd i2 LEFT JOIN ( \
SELECT * FROM icd i1, icd10uatree t1 \
	WHERE (lower(i1.icd_code) LIKE LOWER(:likeText) \
	OR lower(i1.icd_name) LIKE LOWER(:likeText)) \
	AND t1.icd10uatree_id = i1.icd_id \
	) i1 ON i1.icd10uatree_parent_id = i2.icd_id \
	WHERE i1.icd_id IS NOT NULL \
UNION \
SELECT i1.icd_id uid, t1.cnt cnt, i1.* FROM icd i1 \
 LEFT JOIN (SELECT icd10uatree_parent_id, count(*) cnt FROM icd10uatree GROUP BY icd10uatree_parent_id) t1  \
 ON t1.icd10uatree_parent_id = i1.icd_id \
	WHERE lower(i1.icd_name) LIKE LOWER(:likeText) \
	AND LOWER(i1.icd_name) LIKE LOWER(:likeText) \
	) i ORDER BY icd_code \

# hol1Eih icd END

sql.hol1Eih.history_diagnos-icd-group: \
SELECT i2.icd_code,history_id, history_diagnos_id FROM icd i2,  icd i1, ( \
SELECT history_diagnos_id,history_id,icd_id FROM history_diagnos WHERE diagnos_id=4  \
) hd \
WHERE i2.icd_id=hd.icd_id \
AND i2.icd_left_key >=i1.icd_left_key AND i2.icd_left_key <=i1.icd_right_key AND i1.icd_root=i2.icd_root \

sql.hol1Eih.history_diagnos-icd: \
SELECT icd_code,history_id, history_diagnos_id FROM icd i, \
( SELECT history_id, history_diagnos_id, history_diagnos_additional, icd_id FROM history_diagnos WHERE diagnos_id=4 ) hd \
WHERE i.icd_id = hd.icd_id \

#3500 

sql.hol1Eih.f20t3500.all: \
${sql.hol1Eih.f20t3500.nrr_sgroup} \
UNION \
${sql.hol1Eih.f20t3500.nrr_group} \
UNION \
${sql.hol1Eih.f20t3500.nrr_1.0}

sql.hol1Eih.f20t3500.nrr_sgroup: \
SELECT operation_group_id*100+operation_subgroup_id groupById, ${sql.hol1Eih.f20t3500.cntSum} \
FROM (${sql.hol1Eih.f20t3500.list}) x \
GROUP BY operation_subgroup_id

sql.hol1Eih.f20t3500.nrr_group: \
SELECT operation_group_id*100 groupById, ${sql.hol1Eih.f20t3500.cntSum} \
FROM (${sql.hol1Eih.f20t3500.list}) x \
GROUP BY operation_group_id

sql.hol1Eih.f20t3500.nrr_1.0: \
SELECT 1 groupById, ${sql.hol1Eih.f20t3500.cntSum} \
FROM (${sql.hol1Eih.f20t3500.list}) x

sql.hol1Eih.f20t3500.cntSum: \
count(*) cnt, sum(age17) age17, sum(dead) dead, sum(dead17) dead17, sum(selo) selo 

sql.hol1Eih.f20t3500.list: \
SELECT p.patient_surname, h.history_no \
, locality_type=0 selo \
, result_id=5 dead \
,result_id=5 AND TIMESTAMPDIFF(YEAR,p.patient_dob,oh.operation_history_end) <=17 dead17 \
,result_id \
,TIMESTAMPDIFF(YEAR,p.patient_dob,oh.operation_history_end) <=17 AS age17 \
,TIMESTAMPDIFF(YEAR,p.patient_dob,oh.operation_history_end) AS age \
,p.patient_dob, oh.*  \
FROM ( ${sql.hol1Eih.operationHistory.listOfMonthYearPerion} ) oh, history h, patient p, locality l \
WHERE h.history_id = oh.history_id AND p.patient_id=h.patient_id AND l.locality_id=p.locality_id

sql.hol1Eih.operationHistory.countOfMonthYearPerion: \
SELECT count(*) count FROM ( ${sql.hol1Eih.operationHistory.listOfMonthYearPerion}) x

sql.hol1Eih.operationHistory.listOfMonthYearPerion: \
SELECT * FROM operation_history oh \
WHERE YEAR(oh.operation_history_end) = :year  \
AND MONTH(oh.operation_history_end) >= :min_month \
AND MONTH(oh.operation_history_end) <= :max_month \

#3500  END

#3600 

sql.hol1Eih.f20t3600.op_after24: \
, (SELECT history_id FROM operation_history oh, \
(SELECT * FROM operation where operation_name LIKE '%24%' AND !(operation_name LIKE '%\u0434\u043E 24%')) op_after24 \
WHERE oh.operation_id = op_after24.operation_id) op_after24 \
WHERE op_after24.history_id=hd_icd.history_id

sql.hol1Eih.f20t3600.row.2:  SELECT '2'  nrr, icd_code, hd_icd.history_id, history_diagnos_id FROM (${sql.hol1Eih.f20t3600.row.1})  hd_icd ${sql.hol1Eih.f20t3600.op_after24}
sql.hol1Eih.f20t3600.row.4:  SELECT '4'  nrr, icd_code, hd_icd.history_id, history_diagnos_id FROM (${sql.hol1Eih.f20t3600.row.3})  hd_icd ${sql.hol1Eih.f20t3600.op_after24}
sql.hol1Eih.f20t3600.row.6:  SELECT '6'  nrr, icd_code, hd_icd.history_id, history_diagnos_id FROM (${sql.hol1Eih.f20t3600.row.5})  hd_icd ${sql.hol1Eih.f20t3600.op_after24}
sql.hol1Eih.f20t3600.row.8:  SELECT '8'  nrr, icd_code, hd_icd.history_id, history_diagnos_id FROM (${sql.hol1Eih.f20t3600.row.7})  hd_icd ${sql.hol1Eih.f20t3600.op_after24}
sql.hol1Eih.f20t3600.row.10: SELECT '10' nrr, icd_code, hd_icd.history_id, history_diagnos_id FROM (${sql.hol1Eih.f20t3600.row.9})  hd_icd ${sql.hol1Eih.f20t3600.op_after24}
sql.hol1Eih.f20t3600.row.12: SELECT '12' nrr, icd_code, hd_icd.history_id, history_diagnos_id FROM (${sql.hol1Eih.f20t3600.row.11}) hd_icd ${sql.hol1Eih.f20t3600.op_after24}
sql.hol1Eih.f20t3600.row.14: SELECT '14' nrr, icd_code, hd_icd.history_id, history_diagnos_id FROM (${sql.hol1Eih.f20t3600.row.13}) hd_icd ${sql.hol1Eih.f20t3600.op_after24}
sql.hol1Eih.f20t3600.row.18: SELECT '18' nrr, icd_code, hd_icd.history_id, history_diagnos_id FROM (${sql.hol1Eih.f20t3600.row.17}) hd_icd ${sql.hol1Eih.f20t3600.op_after24}

sql.hol1Eih.f20t3600.row.1: \
SELECT '1' nrr, hd_icd.* FROM (${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K56%' \
) hd_icd

sql.hol1Eih.f20t3600.row.3: SELECT '3' nrr, hd_icd.* FROM (${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K35%' \
) hd_icd

sql.hol1Eih.f20t3600.row.5: SELECT '5' nrr, hd_icd.* FROM (${sql.hol1Eih.history_diagnos-icd} \
AND (((i.icd_code like 'K25%' OR i.icd_code like 'K26%' OR i.icd_code like 'K27%' OR i.icd_code like 'K28%') \
AND history_diagnos_additional like '%\u043F\u0435\u0440\u0444%' AND history_diagnos_additional like '%\u0448\u043B\u0443\u043D%') \
OR i.icd_code = 'K25.1' OR i.icd_code = 'K25.2' OR i.icd_code = 'K25.5' OR i.icd_code = 'K25.6' \
OR i.icd_code = 'K26.1' OR i.icd_code = 'K26.2' OR i.icd_code = 'K25.5' OR i.icd_code = 'K25.6' \
OR i.icd_code = 'K27.1' OR i.icd_code = 'K27.2' OR i.icd_code = 'K27.5' OR i.icd_code = 'K27.6' \
OR i.icd_code = 'K28.1' OR i.icd_code = 'K28.2' OR i.icd_code = 'K28.5' OR i.icd_code = 'K28.6' \
)) hd_icd

sql.hol1Eih.f20t3600.row.7: SELECT '7' nrr, hd_icd.* FROM (${sql.hol1Eih.history_diagnos-icd} \
AND (((i.icd_code like 'K25%' OR i.icd_code like 'K26%' OR i.icd_code like 'K27%' OR i.icd_code like 'K28%') \
AND history_diagnos_additional like '%\u043A\u0440\u043E\u0432%') \
OR i.icd_code = 'K25.0' OR i.icd_code = 'K25.2' OR i.icd_code = 'K25.4' OR i.icd_code = 'K25.6' \
OR i.icd_code = 'K26.0' OR i.icd_code = 'K26.2' OR i.icd_code = 'K25.4' OR i.icd_code = 'K25.6' \
OR i.icd_code = 'K27.0' OR i.icd_code = 'K27.2' OR i.icd_code = 'K27.4' OR i.icd_code = 'K27.6' \
OR i.icd_code = 'K28.0' OR i.icd_code = 'K28.2' OR i.icd_code = 'K28.4' OR i.icd_code = 'K28.6' \
)) hd_icd

sql.hol1Eih.f20t3600.row.9: SELECT '9' nrr, hd_icd.* FROM (${sql.hol1Eih.history_diagnos-icd} \
AND (i.icd_code = 'K40.0' OR i.icd_code = 'K40.1' OR i.icd_code = 'K40.3' OR i.icd_code = 'K40.4' \
OR   i.icd_code = 'K41.0' OR i.icd_code = 'K41.1' OR i.icd_code = 'K41.3' OR i.icd_code = 'K41.4' \
OR   i.icd_code = 'K42.0' OR i.icd_code = 'K42.1' \
OR   i.icd_code = 'K43.0' OR i.icd_code = 'K43.1' \
OR   i.icd_code = 'K44.0' OR i.icd_code = 'K44.1' \
OR   i.icd_code = 'K46.0' OR i.icd_code = 'K46.1' \
)) hd_icd

sql.hol1Eih.f20t3600.row.11: SELECT '11' nrr, hd_icd.* FROM (${sql.hol1Eih.history_diagnos-icd} \
AND (i.icd_code = 'K81.0' OR i.icd_code = 'K80.0' \
OR (history_diagnos_additional like '%\u0445\u043E\u043B\u0435\u0446\u0438\u0441\u0442\u0438\u0442%' \
AND history_diagnos_additional like '%\u0433\u043E\u0441\u0442\u0440\u0438\u0439%') \
)) hd_icd

sql.hol1Eih.f20t3600.row.13: SELECT '13' nrr, hd_icd.* FROM (${sql.hol1Eih.history_diagnos-icd} \
AND (i.icd_code = 'K85'  \
)) hd_icd

sql.hol1Eih.f20t3600.row.17: SELECT '17' nrr, hd_icd.* FROM (${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'S30-S39' \
OR i1.icd_code = 'S25' OR i1.icd_code = 'S26' OR i1.icd_code = 'S27' OR i1.icd_code = 'S28' \
)) hd_icd

#3600 END

#3220
sql.hol1Eih.f20t3220.history_diagnos-icd.1_0: SELECT '1.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND !(ascii(substr(i.icd_code,1,1))>84) \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.2_0: SELECT '2.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'A00-B99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.2_1: SELECT '2.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'A00-A09' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.2_2: SELECT '2.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'A15' \
OR i1.icd_code = 'A16' \
OR i1.icd_code = 'A19.0' \
OR i1.icd_code = 'A19.8' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.2_3: SELECT '2.3' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'A39%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.2_4: SELECT '2.4' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND (i.icd_code LIKE 'A40%' \
OR i.icd_code LIKE 'A41%') \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.2_5: SELECT '2.5' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'B15-B19' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.2_6: SELECT '2.6' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'B18.0.1%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.2_7: SELECT '2.7' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'B18.2%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.3_0: SELECT '3.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'C00-D48' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.3_1: SELECT '3.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'C00-C75' \
OR i1.icd_code = 'C76-C80' \
OR i1.icd_code = 'C81-C96' \
OR i1.icd_code = 'C97-C97' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.3_2: SELECT '3.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'C81-C96' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.4_0: SELECT '4.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'D50-D89' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.4_1: SELECT '4.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'D50-D53' \
OR i1.icd_code = 'D55-D59' \
OR i1.icd_code = 'D60-D64' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.4_2: SELECT '4.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'D65-D69' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.5_0: SELECT '5.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'E00-E90' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.5_1: SELECT '5.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'E01.0' \
OR i1.icd_code = 'E04.0' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.5_2: SELECT '5.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'E01.8' \
OR i1.icd_code = 'E03' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.5_3: SELECT '5.3' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'E10-E14' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.6_0: SELECT '6.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'F00-F99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.7_0: SELECT '7.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'G00-G99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.7_1: SELECT '7.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'G00' \
OR i1.icd_code = 'G03' \
OR i1.icd_code = 'G04' \
OR i1.icd_code = 'G06' \
OR i1.icd_code = 'G08' \
OR i1.icd_code = 'G09' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.7_2: SELECT '7.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'G45%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.7_3: SELECT '7.3' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'G80-G83' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.8_0: SELECT '8.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'H00-H59' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.9_0: SELECT '9.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'H60-H95' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.9_1: SELECT '9.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'H65.0.1' \
OR i1.icd_code = 'H66.0' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_0: SELECT '10.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'I00-I99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_1: SELECT '10.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'I00' \
OR i1.icd_code = 'I01' \
OR i1.icd_code = 'I02' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_2: SELECT '10.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'I05-I09' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_3: SELECT '10.3' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'I10' \
OR i1.icd_code = 'I11' \
OR i1.icd_code = 'I12' \
OR i1.icd_code = 'I13' \
) ) hd_icd


sql.hol1Eih.f20t3220.history_diagnos-icd.10_4: SELECT '10.4' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'I20-I25' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_5: SELECT '10.5' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'I20%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_6: SELECT '10.6' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'I21' \
OR i1.icd_code = 'I22' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_7: SELECT '10.7' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'I24%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_8: SELECT '10.8' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'I60-I69' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_9: SELECT '10.9' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'I60' \
OR i1.icd_code = 'I61' \
OR i1.icd_code = 'I62' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_10: SELECT '10.10' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'I63%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.10_11: SELECT '10.11' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'I64%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.11_0: SELECT '11.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'J00-J99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.11_1: SELECT '11.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'I12' \
OR i1.icd_code = 'I13' \
OR i1.icd_code = 'I14' \
OR i1.icd_code = 'I15' \
OR i1.icd_code = 'I16' \
OR i1.icd_code = 'I18' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.11_2: SELECT '11.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'I44.0' \
OR i1.icd_code = 'I44.1' \
OR i1.icd_code = 'I44.9' \
) ) hd_icd


sql.hol1Eih.f20t3220.history_diagnos-icd.11_3: SELECT '11.3' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'J44.8.2%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.11_4: SELECT '11.4' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'I45' \
OR i1.icd_code = 'I46' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.11_5: SELECT '11.5' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'J47%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_0: SELECT '12.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'K00-K93' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_1: SELECT '12.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'K04' \
OR i1.icd_code = 'K05' \
OR i1.icd_code = 'K06' \
OR i1.icd_code = 'K07' \
OR i1.icd_code = 'K08' \
OR i1.icd_code = 'K09' \
OR i1.icd_code = 'K10' \
OR i1.icd_code = 'K11' \
OR i1.icd_code = 'K12' \
OR i1.icd_code = 'K13' \
OR i1.icd_code = 'K14' \
OR i1.icd_code = 'K15' \
OR i1.icd_code = 'K16' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_2: SELECT '12.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K21%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_3: SELECT '12.3' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'K25' \
OR i1.icd_code = 'K26' \
OR i1.icd_code = 'K27' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_4: SELECT '12.4' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'K25.1' \
OR i1.icd_code = 'K25.2' \
OR i1.icd_code = 'K25.5' \
OR i1.icd_code = 'K25.6' \
OR i1.icd_code = 'K26.1' \
OR i1.icd_code = 'K26.2' \
OR i1.icd_code = 'K26.5' \
OR i1.icd_code = 'K26.6' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_5: SELECT '12.5' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K29%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_6: SELECT '2.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'K29.0' \
OR i1.icd_code = 'K29.6' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_7: SELECT '12.7' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K30%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_8: SELECT '12.8' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K35%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_9: SELECT '12.9' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'K40-K46' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_10: SELECT '12.10' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'K40.0' \
OR i1.icd_code = 'K40.1' \
OR i1.icd_code = 'K40.3' \
OR i1.icd_code = 'K40.4' \
OR i1.icd_code = 'K41.0' \
OR i1.icd_code = 'K41.1' \
OR i1.icd_code = 'K41.3' \
OR i1.icd_code = 'K41.4' \
OR i1.icd_code = 'K42.0' \
OR i1.icd_code = 'K42.1' \
OR i1.icd_code = 'K42.3' \
OR i1.icd_code = 'K42.4' \
OR i1.icd_code = 'K43.0' \
OR i1.icd_code = 'K43.1' \
OR i1.icd_code = 'K43.3' \
OR i1.icd_code = 'K43.4' \
OR i1.icd_code = 'K44.0' \
OR i1.icd_code = 'K44.1' \
OR i1.icd_code = 'K44.3' \
OR i1.icd_code = 'K44.4' \
OR i1.icd_code = 'K45.0' \
OR i1.icd_code = 'K45.1' \
OR i1.icd_code = 'K45.3' \
OR i1.icd_code = 'K45.4' \
OR i1.icd_code = 'K46.0' \
OR i1.icd_code = 'K46.1' \
OR i1.icd_code = 'K46.3' \
OR i1.icd_code = 'K46.4' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_11: SELECT '12.11' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K50%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_12: SELECT '12.12' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K51%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_13: SELECT '12.13' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K58%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_14: SELECT '12.14' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'K70.3' \
OR i1.icd_code = 'K71.7' \
OR i1.icd_code = 'K74.3' \
OR i1.icd_code = 'K74.4' \
OR i1.icd_code = 'K74.5' \
OR i1.icd_code = 'K74.6' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_15: SELECT '12.15' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'K80' \
OR i1.icd_code = 'K81' \
OR i1.icd_code = 'K82.2' \
OR i1.icd_code = 'K83.0' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_16: SELECT '12.16' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'K80.0' \
OR i1.icd_code = 'K81.0' \
OR i1.icd_code = 'K82.2' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_17: SELECT '12.17' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'K85' \
OR i1.icd_code = 'K86' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_18: SELECT '12.18' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K85%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.12_19: SELECT '12.19' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'K90.0%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.13_0: SELECT '13.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'L00-L99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.14_0: SELECT '14.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'M00-M99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.14_1: SELECT '14.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'M05' \
OR i1.icd_code = 'M06' \
OR i1.icd_code = 'M08' \
OR i1.icd_code = 'M10' \
OR i1.icd_code = 'M11' \
OR i1.icd_code = 'M12' \
OR i1.icd_code = 'M13' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.14_2: SELECT '14.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'M05' \
OR i1.icd_code = 'M06' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.14_3: SELECT '14.3' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'M86%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.14_4: SELECT '14.4' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'M40-M43' \
OR i1.icd_code = 'M46' \
OR i1.icd_code = 'M47' \
OR i1.icd_code = 'M48' \
OR i1.icd_code = 'M53' \
OR i1.icd_code = 'M54' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.15_0: SELECT '15.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'N00-N99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.15_1: SELECT '15.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'N00%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.15_2: SELECT '15.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'N03%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.15_3: SELECT '15.3' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'N10' \
OR i1.icd_code = 'N11' \
OR i1.icd_code = 'N13' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.15_4: SELECT '15.4' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'N11%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.15_5: SELECT '15.5' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'N20%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.15_6: SELECT '15.6' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'N40' \
OR i1.icd_code = 'N41' \
OR i1.icd_code = 'N42' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.16_0: SELECT '16.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'O00-O99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.17_0: SELECT '17.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'P00-P96' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.18_0: SELECT '18.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'Q00-Q99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.19_0: SELECT '19.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'R00-R99' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.20_0: SELECT '20.0' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'S00-T98' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.20_1: SELECT '20.1' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'S02' \
OR i1.icd_code = 'S12' \
OR i1.icd_code = 'S22' \
OR i1.icd_code = 'S32' \
OR i1.icd_code = 'T02' \
OR i1.icd_code = 'T08' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.20_2: SELECT '20.2' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd} \
AND i.icd_code LIKE 'S06%' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.20_3: SELECT '20.3' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND (i1.icd_code = 'S26' \
OR i1.icd_code = 'S27' \
OR i1.icd_code = 'S36' \
OR i1.icd_code = 'S37' \
) ) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.20_4: SELECT '20.4' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'T20-T32' \
) hd_icd

sql.hol1Eih.f20t3220.history_diagnos-icd.20_5: SELECT '20.5' nrr, hd_icd.* FROM ( \
${sql.hol1Eih.history_diagnos-icd-group} \
AND i1.icd_code = 'T36-T50' \
) hd_icd

sql.hol1Eih.f20t3220.year_month2: \
SELECT nrr, count(nrr) cnt, sum(bedday) bedday, count(dead) dead \
, count(age17) age17, count(age1) age1, sum(bedday17) bedday17, count(dead17) dead17, count(dead1) dead1 FROM ( \
SELECT nrr, icd_code, h.* FROM ( \
${sql.hol1Eih.f20t3220.history_diagnos-icd.1_0} \
) hd_icd, (\
${sql.hol1Eih.history.year_month} \
) h WHERE h.history_id=hd_icd.history_id \
) i \
GROUP BY nrr

#3220 END

sql.hol1Eih.f20t3600.year_month: \
SELECT nrr, count(nrr) cnt \
, count(op_no_1) op_no_1 \
, count(op_no_17_2) op_no_17_2 \
, count(dead_op_no_3) dead_op_no_3 \
, count(dead_op_no_17_4) dead_op_no_17_4 \
, count(op_yes_5) op_yes_5 \
, count(op_yes_17_6) op_yes_17_6 \
, count(dead_op_yes_7) dead_op_yes_7 \
, count(dead_op_yes_17_8) dead_op_yes_17_8 \
FROM (SELECT nrr, icd_code, h.* FROM ( \
${sql.hol1Eih.f20t3600.row.1} \
UNION ${sql.hol1Eih.f20t3600.row.2} \
UNION ${sql.hol1Eih.f20t3600.row.3} \
UNION ${sql.hol1Eih.f20t3600.row.4} \
UNION ${sql.hol1Eih.f20t3600.row.5} \
UNION ${sql.hol1Eih.f20t3600.row.6} \
UNION ${sql.hol1Eih.f20t3600.row.7} \
UNION ${sql.hol1Eih.f20t3600.row.8} \
UNION ${sql.hol1Eih.f20t3600.row.9} \
UNION ${sql.hol1Eih.f20t3600.row.10} \
UNION ${sql.hol1Eih.f20t3600.row.11} \
UNION ${sql.hol1Eih.f20t3600.row.12} \
UNION ${sql.hol1Eih.f20t3600.row.13} \
UNION ${sql.hol1Eih.f20t3600.row.14} \
UNION ${sql.hol1Eih.f20t3600.row.17} \
UNION ${sql.hol1Eih.f20t3600.row.18} \
) hd_icd, (\
${sql.hol1Eih.f20t3600_column.year_month} \
) h WHERE h.history_id=hd_icd.history_id \
) i \
GROUP BY nrr

sql.hol1Eih.f20t3220.year_month: \
SELECT nrr, count(nrr) cnt, sum(bedday) bedday, count(dead) dead \
, count(age17) age17, count(age1) age1, sum(bedday17) bedday17, count(dead17) dead17, count(dead1) dead1 FROM ( \
SELECT nrr, icd_code, h.* FROM ( \
${sql.hol1Eih.f20t3220.history_diagnos-icd.2_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.2_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.2_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.2_3} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.2_4} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.2_5} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.2_6} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.2_7} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.3_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.3_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.3_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.4_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.4_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.4_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.5_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.5_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.5_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.5_3} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.6_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.7_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.7_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.7_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.7_3} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.8_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.9_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.9_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_3} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_4} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_5} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_6} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_7} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_8} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_9} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_10} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.10_11} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.11_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.11_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.11_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.11_3} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.11_4} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.11_5} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_3} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_4} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_5} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_6} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_7} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_8} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_9} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_10} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_11} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_12} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_13} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_14} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_15} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_16} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_17} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_18} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.12_19} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.13_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.14_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.14_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.14_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.14_3} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.14_4} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.15_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.15_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.15_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.15_3} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.15_4} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.15_5} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.15_6} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.16_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.17_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.18_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.19_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.20_0} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.20_1} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.20_2} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.20_3} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.20_4} \
UNION ${sql.hol1Eih.f20t3220.history_diagnos-icd.20_5} \
) hd_icd, (\
${sql.hol1Eih.history.year_month} \
) h WHERE h.history_id=hd_icd.history_id \
) i \
GROUP BY nrr

sql.hol1Eih.history.year_month1: \
SELECT * FROM history h \
WHERE year(history_out)=:year AND month(history_out)>=:min_month AND month(history_out)<=:max_month

sql.hol1Eih.f20t3600_column.year_month: SELECT p.patient_id, history_out, history_no, h.history_id, IF(result_id = 4,true, null) dead, \
IF(oh.history_id is null,true, null) op_no_1, \
IF(oh.history_id is null && TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<18,true, null) op_no_17_2, \
IF(oh.history_id is null && result_id = 4,true, null) dead_op_no_3, \
IF(oh.history_id is null && result_id = 4 && TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<18,true, null) dead_op_no_17_4, \
IF(oh.history_id is not null,true, null) op_yes_5, \
IF(oh.history_id is not null && TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<18,true, null) op_yes_17_6, \
IF(oh.history_id is not null && result_id = 4,true, null) dead_op_yes_7, \
IF(oh.history_id is not null && result_id = 4 && TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<18,true, null) dead_op_yes_17_8, \
IF(TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<18,true,null) AS age17 \
FROM patient p , history h LEFT JOIN ( \
 SELECT min(operation_history_end) oh_1_end, count(history_id) oh_cnt, history_id FROM operation_history oh group by history_id \
) oh ON oh.history_id=h.history_id \
WHERE h.patient_id=p.patient_id AND history_out is not null \
AND year(history_out)=:year AND month(history_out)>=:min_month AND month(history_out)<=:max_month 

sql.hol1Eih.history.year_month: SELECT h.patient_id, history_no, \
TIMESTAMPDIFF(DAY,h.history_in,h.history_out)+1 AS bedday, \
if(result_id = 4,true, null) dead, \
if(TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<18,true,null) AS age17, \
if(TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<1,true,null) AS age1, \
if(TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<18,TIMESTAMPDIFF(DAY,h.history_in,h.history_out)+1,null) AS bedday17, \
if(result_id = 4 && TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<18,true, null) dead17, \
if(result_id = 4 && TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out)<1,true, null) dead1, \
TIMESTAMPDIFF(YEAR,p.patient_dob,h.history_out) AS age, h.history_id \
FROM history h, patient p \
WHERE h.patient_id=p.patient_id AND history_out is not null \
AND year(history_out)=:year AND MONTH(history_out)>=:min_month AND MONTH(history_out)<=:max_month

sql.hol1Eih.f20t3600.nrr_patients.year_month: \
SELECT * FROM ( \
${sql.hol1Eih.f20t3600_column.year_month} \
) h, (:nrr_sql) nrr, ( \
SELECT patient_id, patient_surname, patient_name, patient_patronnymic, patient_gender, patient_dob FROM patient \
) p, ( SELECT history_id, icd_name, history_diagnos_id, history_diagnos_additional FROM history_diagnos hd, icd i \
WHERE hd.diagnos_id=4 AND i.icd_id=hd.icd_id \
) hd \
WHERE hd.history_diagnos_id=nrr.history_diagnos_id AND nrr.history_id=h.history_id AND h.patient_id=p.patient_id

sql.hol1Eih.f20t3220.nrr_patients.year_month: \
SELECT * FROM ( \
${sql.hol1Eih.history.year_month} \
) h, (:nrr_sql) nrr, ( \
SELECT patient_id, patient_surname, patient_name, patient_patronnymic, patient_gender, patient_dob FROM patient \
) p \
WHERE nrr.history_id=h.history_id AND h.patient_id=p.patient_id

sql.hol1Eih.f20t3220.all: \
SELECT count(nrr) cnt, i.* FROM \
( \
${sql.hol1Eih.f20t3220.history_diagnos-icd.15_4} \
) i \
GROUP BY nrr

sql.hol1Eih.readHistoryYears: \
SELECT COUNT(year(history_out)) cnt, YEAR(history_out) year \
FROM history \
WHERE YEAR(history_out) IS NOT NULL AND YEAR(history_out)!=0 \
GROUP BY year \
ORDER BY year DESC;

sql.hol1Eih.update.icd.icd10uatree_with_parent_name: UPDATE icd10uatree \
SET icd10uatree_with_parent_name = !icd10uatree_with_parent_name \
WHERE icd10uatree_id =:icdId

sql.hol1Eih.update.operation_history.type.variable.value: UPDATE operation_history \
SET :field = :value WHERE operation_history_id = :operationHistoryId

sql.hol1Eih.update.operation_history.operation_history_duration: \
UPDATE operation_history oh \
LEFT JOIN operation_history ohs ON oh.operation_history_id=ohs.operation_history_id \
SET oh.operation_history_duration = :operationHistoryDuration \
, oh.operation_history_end = FROM_UNIXTIME(UNIX_TIMESTAMP(ohs.operation_history_start) + :operationHistoryDuration)  \
WHERE oh.operation_history_id = :operationHistoryId

sql.hol1Eih.update.operation_history.operation_history_start: UPDATE operation_history \
SET operation_history_start = :operationHistoryStartTS \
WHERE operation_history_id = :operationHistoryId;

sql.hol1Eih.update.operation_history.operation_history_end: \
UPDATE operation_history oh LEFT JOIN operation_history ohs ON oh.operation_history_id=ohs.operation_history_id \
SET oh.operation_history_end = FROM_UNIXTIME(UNIX_TIMESTAMP(ohs.operation_history_start) + ohs.operation_history_duration) \
WHERE oh.operation_history_id = :operationHistoryId

sql.hol1Eih.update.operation_history.operation_history_start1: UPDATE operation_history \
SET operation_history_start = FROM_UNIXTIME(:operationHistoryStart * 0,001) \
WHERE operation_history_id = :operationHistoryId


sql.hol1Eih.update.operation_history.icd: UPDATE operation_history oh LEFT JOIN icd icd ON icd.icd_id=:icdId \
SET oh.icd_id = icd.icd_id, oh.icd_start = icd.icd_start, oh.icd_end = icd.icd_end  \
WHERE operation_history_id = :operationHistoryId

sql.hol1Eih.select.icd.start-end: SELECT icd_start, icd_end FROM  icd where icd_id=:icdId
sql.hol1Eih.insert.operation_history.procedure_moz: INSERT INTO operation_history_moz VALUES (:operationHistoryId, :procedureMozId)
sql.hol1Eih.update.operation_history.procedure_moz: UPDATE operation_history_moz \
SET procedure_moz_id = :procedureMozId WHERE operation_history_moz_id = :operationHistoryId

sql.hol1Eih.operation_history.delete: DELETE FROM operation_history WHERE operation_history_id = :operationHistoryId

sql.hol1Eih.operation_history.history_id: \
SELECT o.operation_code, o.operation_name, ore.operation_result_name , d.department_name, ps.surgery_name , oh.* \
FROM \
	(SELECT oc.operation_complication_name, anesthetist_name, a.anestesia_name, icd.*, oh.* , ohm.* \
	FROM operation_history oh \
	LEFT JOIN \
		( SELECT ohm.operation_history_moz_id, pm.procedure_moz_id , pm.procedure_moz_code \
		, CONCAT(IF(pm.procedure_moz_parent_name IS NULL, '', pm.procedure_moz_parent_name), ' ', pm.procedure_moz_name) procedure_moz_name \
			FROM operation_history_moz ohm, procedure_moz pm \
			WHERE ohm.procedure_moz_id=pm.procedure_moz_id \
		) ohm  ON ohm.operation_history_moz_id = oh.operation_history_id \
	LEFT JOIN \
		( SELECT t.*, i.icd_code, concat(if(i2.icd_name is not null,concat(i2.icd_name,'. '),''),i.icd_name) icd_name \
			FROM icd i, icd10uatree t \
			LEFT JOIN icd i2 ON t.icd10uatree_parent_id=i2.icd_id AND icd10uatree_with_parent_name \
			WHERE i.icd_id=icd10uatree_id \
	) icd ON icd.icd10uatree_id = oh.icd_id \
	LEFT JOIN operation_complication oc ON oh.operation_complication_id = oc.operation_complication_id \
	LEFT JOIN anestesia a  ON a.anestesia_id = oh.anestesia_id \
	LEFT JOIN \
		( SELECT concat(personal_surname, ', ', personal_name, ' ', personal_patronymic) anesthetist_name, personal_id \
			FROM personal \
		) pa ON oh.anesthetist_id = pa.personal_id \
	WHERE oh.history_id = :historyId \
	) oh ,( SELECT CONCAT(personal_surname, ', ', personal_name, ' ', personal_patronymic) surgery_name, personal_id \
	  FROM personal \
	) ps ,  operation o, department d, operation_result ore \
WHERE oh.operation_result_id = ore.operation_result_id  AND oh.personal_id = ps.personal_id  AND  oh.department_id =  d.department_id  AND o.operation_id=oh.operation_id 

sql.hol1Eih.operation_history.history_id.stop: \
SELECT o.operation_code, o.operation_name, ore.operation_result_name , d.department_name, ps.surgery_name , oh.*  \
FROM (SELECT oc.operation_complication_name, anesthetist_name, a.anestesia_name, icd_code, icd_name, oh.* \
	FROM operation_history oh  \
		LEFT JOIN icd icd ON icd.icd_id = oh.icd_id \
	LEFT JOIN operation_complication oc ON oh.operation_complication_id = oc.operation_complication_id  \
	LEFT JOIN anestesia a ON a.anestesia_id = oh.anestesia_id  \
	LEFT JOIN ( SELECT concat(personal_surname, ', ', personal_name, ' ', personal_patronymic) anesthetist_name, personal_id  \
			FROM personal \
		) pa ON oh.anesthetist_id = pa.personal_id  \
	WHERE oh.history_id = :historyId \
	) oh ,( SELECT concat(personal_surname, ', ', personal_name, ' ', personal_patronymic) surgery_name, personal_id  \
		FROM personal \
	) ps ,  operation o, department d, operation_result ore  \
WHERE oh.operation_result_id = ore.operation_result_id  \
	AND oh.personal_id = ps.personal_id  \
	AND  oh.department_id =  d.department_id  \
	AND o.operation_id=oh.operation_id

sql.hol1Eih.operation_history2.history_id:  SELECT operation_history_id, oh.operation_id, operation_code, operation_name \
, icd_code, icd_name , oh.*  \
FROM operation_history oh, operation o, icd icd \
 where history_id=:historyId and o.operation_id=oh.operation_id and icd.icd_id=oh.icd_id

sql.hol1Eih.history.id: SELECT * FROM history h, patient p where history_id=:historyId and h.patient_id=p.patient_id
sql.hol1Eih.department-patient: SELECT concat(p.patient_surname, ' ', p.patient_name, ' ', p.patient_patronnymic) name, \
	dh.department_history_in, h.history_in, h.history_out, h.history_no, h.history_id, h.patient_id \
FROM department_history dh, history h, patient p \
WHERE dh.department_id = :departmentId AND h.patient_id = p.patient_id AND h.history_id=dh.history_id AND dh.department_history_out IS NULL;

#########################
sql.select.list.procedure_operation: SELECT po.*, p.PROCEDURE_NAME, o.OPERATION_NAME \
FROM list.PROCEDURE_operation po, list.PROCEDURE p, hol1.OPERATION o \
where po.PROCEDURE_CODE=p.PROCEDURE_CODE \
and po.OPERATION_CODE=o.OPERATION_CODE and 0=:num;

sql.insert.list.procedure_operation: insert into list.PROCEDURE_operation values (:PROCEDURE_CODE,:OPERATION_CODE);
sql.hol1.operation.group: SELECT * FROM hol1.OPERATION_GROUP where OPERATION_GROUP_id > :nullParameter
sql.hol1.operation.subgroup: SELECT * FROM hol1.OPERATION_SUBGROUP where OPERATION_GROUP_ID=:operationGroupId
sql.hol1.operation.operation: SELECT * FROM hol1.OPERATION where OPERATION_SUBGROUP_ID=:operationSubGroupId

sql.hol1.operation.seek: SELECT distinct g.operation_group_id uid,  g.operation_group_id,  null operation_subgroup_id, null operation_id, null operation_code,  operation_group_name name, null urgent \
 FROM hol1.operation_group g, hol1.operation_subgroup s, hol1.operation o \
 where g.operation_group_id = s.operation_group_id \
 and o.operation_subgroup_id = s.operation_subgroup_id \
and lower(operation_name) like lower(:likeText) \
union \
SELECT distinct s.operation_subgroup_id uid,  operation_group_id,  s.operation_subgroup_id, null operation_id, null operation_code,  operation_subgroup_name name, null urgent \
 FROM hol1.operation_subgroup s, hol1.operation o \
 where o.operation_subgroup_id = s.operation_subgroup_id \
and lower(operation_name) like lower(:likeText) \
union \
SELECT operation_id uid, operation_group_id, o.operation_subgroup_id, operation_id, operation_code,  operation_name name, operation_urgent  urgent \
 FROM hol1.operation o, hol1.operation_subgroup s \
  where o.operation_subgroup_id = s.operation_subgroup_id \
and lower(operation_name) like lower(:likeText) \
order by operation_group_id, operation_subgroup_id, operation_id

sql.hol1.show-table.names:operation_history, history
sql.hol1.show-table.columns: show columns from :tableName

sql.hol1.anesthesia:SELECT * FROM anestesia
sql.hol1.operation_result:SELECT * FROM operation_result
sql.hol1.complication:SELECT * FROM operation_complication
sql.hol1.complication.department:SELECT oc.*, oh.cnt \
FROM operation_complication oc, \
	(SELECT operation_complication_id, COUNT(operation_complication_id) cnt \
	FROM operation_history \
	WHERE operation_complication_id IS NOT NULL AND department_id=:departmentId \
	GROUP BY operation_complication_id ) oh \
WHERE oc.operation_complication_id=oh.operation_complication_id \
ORDER by cnt DESC

sql.hol1.department.operation: SELECT * FROM department \
where department_active and department_profile_id <3 order by department_profile_id desc, department_name
sql.hol1.anesthetist:SELECT personal_id, personal_username \
, concat(personal_surname,', ',personal_name, ' ', personal_patronymic) name FROM personal p where personal_anesthetist

sql.hol1.anesthetist.department: SELECT acnt.*, p.personal_username \
FROM personal p, \
	(SELECT anesthetist_id, count(*) cnt \
	FROM operation_history \
	WHERE department_id=26 \
	GROUP BY anesthetist_id) acnt \
WHERE p.personal_id=anesthetist_id \
ORDER BY cnt DESC;

sql.hol1.surgery: SELECT personal_id, personal_username \
, concat(personal_surname,', ',personal_name, ' ', personal_patronymic) name FROM personal where personal_surgeon
sql.hol1.surgery.department: SELECT p.personal_id, personal_username, cnt \
, concat(personal_surname,', ',personal_name, ' ', personal_patronymic) name  \
FROM personal_department pd, personal p, \
	(SELECT personal_id, count(personal_id) cnt \
	FROM operation_history \
	group by personal_id) pcnt \
where pd.department_id=:departmentId and p.personal_id=pd.personal_id and personal_surgeon and p.personal_id=pcnt.personal_id \
order by cnt desc


sql.hol1.procedure-operation.sibling:SELECT procedure_moz_id, procedure_moz_parent_id, procedure_moz_code \
, if(procedure_moz_parent_name is null, procedure_moz_name, concat(procedure_moz_parent_name,' ',procedure_moz_name)) procedure_moz_name \
 FROM procedure_moz where procedure_moz_parent_id=:parentId

sql.hol1.procedure-operation.sibling1: SELECT * FROM procedure_moz where procedure_moz_parent_id=:parentId
sql.hol1.icd.seek.stop:SELECT * FROM icd where lower(icd_name) like lower(:likeText) or lower(icd_code) like lower(:likeText)
sql.list.procedure-operation.seek: SELECT DISTINCT p3.PROCEDURE_ID uid, p3.* FROM list.PROCEDURE p3 \
LEFT JOIN \
  (SELECT DISTINCT p2.PROCEDURE_ID uid, p2.* FROM list.PROCEDURE p2 \
   LEFT JOIN \
	 (SELECT DISTINCT p1.PROCEDURE_ID uid, p1.* FROM list.PROCEDURE p1 \
	  LEFT JOIN \
		(SELECT p.PROCEDURE_ID uid, p.* FROM list.PROCEDURE p \
		 WHERE ( lower(PROCEDURE_NAME) LIKE lower(:likeText) \
		 OR lower(PROCEDURE_CODE) LIKE lower(:likeText) )\
   and lower(PROCEDURE_CODE) LIKE lower('%7%') \
		 ) p \
		 ON p1.PROCEDURE_ID= p.PROCEDURE_PARENT_ID \
	  WHERE p.PROCEDURE_ID IS NOT NULL) p1 ON p2.PROCEDURE_ID= p1.PROCEDURE_PARENT_ID \
   WHERE p1.PROCEDURE_ID IS NOT NULL) p2 ON p3.PROCEDURE_ID= p2.PROCEDURE_PARENT_ID \
WHERE p2.PROCEDURE_ID IS NOT NULL \
UNION \
SELECT DISTINCT p2.PROCEDURE_ID uid, p2.* FROM list.PROCEDURE p2 \
LEFT JOIN \
  (SELECT DISTINCT p1.PROCEDURE_ID uid, p1.* FROM list.PROCEDURE p1 \
   LEFT JOIN \
	 (SELECT p.PROCEDURE_ID uid, p.* FROM list.PROCEDURE p \
	  WHERE ( lower(PROCEDURE_NAME) LIKE lower(:likeText) \
		 OR lower(PROCEDURE_CODE) LIKE lower(:likeText) )\
   and lower(PROCEDURE_CODE) LIKE lower('%7%') \
	  ) \
	  p ON p1.PROCEDURE_ID= p.PROCEDURE_PARENT_ID \
   WHERE p.PROCEDURE_ID IS NOT NULL) p1 ON p2.PROCEDURE_ID= p1.PROCEDURE_PARENT_ID \
WHERE p1.PROCEDURE_ID IS NOT NULL \
UNION \
SELECT DISTINCT p1.PROCEDURE_ID uid, p1.* FROM list.PROCEDURE p1 \
LEFT JOIN \
  (SELECT p.PROCEDURE_ID uid, p.* FROM list.PROCEDURE p \
   WHERE ( lower(PROCEDURE_NAME) LIKE lower(:likeText) \
		 OR lower(PROCEDURE_CODE) LIKE lower(:likeText) )\
   and lower(PROCEDURE_CODE) LIKE lower('%7%') \
   ) \
   p ON p1.PROCEDURE_ID= p.PROCEDURE_PARENT_ID \
WHERE p.PROCEDURE_ID IS NOT NULL \
UNION \
SELECT p.PROCEDURE_ID uid, procedure_id, procedure_parent_id, procedure_code \
, concat(procedure_parent_name,' ',procedure_name) procedure_name, null procedure_parent_name FROM list.PROCEDURE p \
WHERE ( lower(concat(procedure_name,procedure_parent_name)) LIKE lower(:likeText) \
		 OR lower(PROCEDURE_CODE) LIKE lower(:likeText) )\
and lower(PROCEDURE_CODE) LIKE lower('%7%') \
ORDER BY PROCEDURE_ID

sql.list.procedure.sibling: SELECT * FROM list.PROCEDURE where PROCEDURE_PARENT_ID=:parentId
sql.list.procedure.seek: SELECT DISTINCT p3.PROCEDURE_ID uid, p3.* FROM list.PROCEDURE p3 \
LEFT JOIN \
  (SELECT DISTINCT p2.PROCEDURE_ID uid, p2.* FROM list.PROCEDURE p2 \
   LEFT JOIN \
	 (SELECT DISTINCT p1.PROCEDURE_ID uid, p1.* FROM list.PROCEDURE p1 \
	  LEFT JOIN \
		(SELECT p.PROCEDURE_ID uid, p.* FROM list.PROCEDURE p \
		 WHERE ( lower(PROCEDURE_NAME) LIKE lower(:likeText) \
		 OR lower(PROCEDURE_CODE) LIKE lower(:likeText) )\
 ) p ON p1.PROCEDURE_ID= p.PROCEDURE_PARENT_ID \
	  WHERE p.PROCEDURE_ID IS NOT NULL) p1 ON p2.PROCEDURE_ID= p1.PROCEDURE_PARENT_ID \
   WHERE p1.PROCEDURE_ID IS NOT NULL) p2 ON p3.PROCEDURE_ID= p2.PROCEDURE_PARENT_ID \
WHERE p2.PROCEDURE_ID IS NOT NULL \
UNION \
SELECT DISTINCT p2.PROCEDURE_ID uid, p2.* FROM list.PROCEDURE p2 \
LEFT JOIN \
  (SELECT DISTINCT p1.PROCEDURE_ID uid, p1.* FROM list.PROCEDURE p1 \
   LEFT JOIN \
	 (SELECT p.PROCEDURE_ID uid, p.* FROM list.PROCEDURE p \
	  WHERE ( lower(PROCEDURE_NAME) LIKE lower(:likeText) \
		 OR lower(PROCEDURE_CODE) LIKE lower(:likeText) )\
 ) p ON p1.PROCEDURE_ID= p.PROCEDURE_PARENT_ID \
   WHERE p.PROCEDURE_ID IS NOT NULL) p1 ON p2.PROCEDURE_ID= p1.PROCEDURE_PARENT_ID \
WHERE p1.PROCEDURE_ID IS NOT NULL \
UNION \
SELECT DISTINCT p1.PROCEDURE_ID uid, p1.* FROM list.PROCEDURE p1 \
LEFT JOIN \
  (SELECT p.PROCEDURE_ID uid, p.* FROM list.PROCEDURE p \
   WHERE ( lower(PROCEDURE_NAME) LIKE lower(:likeText) \
		 OR lower(PROCEDURE_CODE) LIKE lower(:likeText) )\
 ) p ON p1.PROCEDURE_ID= p.PROCEDURE_PARENT_ID \
WHERE p.PROCEDURE_ID IS NOT NULL \
UNION \
SELECT p.PROCEDURE_ID uid, procedure_moz_id, procedure_moz_parent_id, procedure_moz_code \
, concat(procedure_moz_parent_name,' ',procedure_moz_name) procedure_moz_name, null procedure_moz_parent_name FROM list.PROCEDURE p \
WHERE ( lower(concat(procedure_moz_name,procedure_moz_parent_name)) LIKE lower(:likeText) \
		 OR lower(PROCEDURE_CODE) LIKE lower(:likeText) )\
ORDER BY PROCEDURE_ID


stop.sql.list.procedure.seek: SELECT distinct p1.PROCEDURE_ID uid, p1.* FROM list.PROCEDURE p1 left join ( \
SELECT p.PROCEDURE_ID uid, p.* FROM list.PROCEDURE p where PROCEDURE_NAME like :likeText \
) p2 \
on p1.PROCEDURE_ID= p2.PROCEDURE_PARENT_ID \
where p2.PROCEDURE_ID is not null \
union \
SELECT p.PROCEDURE_ID uid, p.* FROM list.PROCEDURE p where PROCEDURE_NAME like :likeText


sql.hol1Eih.departmentMotion: \
 SELECT d1.icd_code, \
		d1.icd_name, \
		h.* \
 FROM \
   (SELECT if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
		   hd.icd_id, \
		   region_name, \
		   direct_name, \
		   concat(history_no,' ',patient_surname,' ',patient_name,' ',patient_patronnymic) name_id, \
		   department_history_in, \
		   department_history_out, \
		   datediff(department_history_out, department_history_in)+1 bed_day \
	FROM history h \
	LEFT JOIN history_diagnos hd ON hd.history_id = h.history_id \
	AND hd.diagnos_id = 3, \
		direct dr, \
		patient p, \
		region r, \
		department_history dh \
	WHERE department_id = :department_id \
	  AND year(department_history_out)  = :year \
	  AND month(department_history_out)  >= :min_month \
	  AND month(department_history_out)  <= :max_month \
	  AND dh.history_id=h.history_id \
	  AND dr.direct_id=h.direct_id \
	  AND p.patient_id=h.patient_id \
	  AND r.region_id = p.region_id) h \
 LEFT JOIN icd d1 ON d1.icd_id=h.icd_id \
 ORDER BY department_history_out

sql.hol1Eih.bedDay: \
  SELECT d.*, \
		 round(if(d.dead IS NULL, 0, d.dead/TREAT*100),2) mortality, \
		 round(bed_day * 100 / bed_day_plan,2) bed_day_fulfil, \
		 round(bed_day  / department_bed,2)  bed_occupancy, \
		 round(bed_day  / TREAT,1) treat_avg, \
		 round((bed_day  / department_bed)/( bed_day / TREAT ),2)  bed_turnover, \
		 round((d.in_clinic+ifnull(d.dead,0))/d.department_bed,2)  bed_turnover2 \
  FROM \
	(SELECT d.*, \
			round((d.in_clinic+ifnull(d.in_dep,0)+d.out_clinic+ifnull(d.out_dep,0)+ifnull(d.dead,0))/2) TREAT \
	 FROM \
	   (SELECT d.department_id dp_id, \
			   d.department_name, \
			   d.department_bed, \
			   if(d.department_id=14,310,340) bd_key, \
			   bed_day_plan, \
			   in_clinic.in_clinic, \
			   in_dep.in_dep, \
			   out_clinic.out_clinic, \
			   out_dep.out_dep, \
			   out_to_clinic.out_to_clinic, \
			   dead.dead, \
			   bed_day.bed_day \
		FROM (/* відділення + розгорнуті ліжка + план ліжкоднів */ \
			  SELECT department_id, \
					 department_name, \
					 department_bed, \
					 sum(bed_day_plan) bed_day_plan \
			  FROM ( /* bed_day_plan */ \
					SELECT *, \
						   round(bd_key/366*month_days*department_bed) bed_day_plan \
					FROM ( /* відділення з ліжкоднями */ \
						  SELECT d.department_id, \
		 department_bed, \
		 d.department_name, \
		 if(d.department_id=14,310,if(d.department_id=23 or d.department_id=10,290,340)) bd_key \
  FROM department_bed db1, \
	   department d, \
	(SELECT max(department_bed_id) department_bed_id \
	 FROM department_bed \
	 GROUP BY department_id) db2 \
  WHERE db1.department_bed_id=db2.department_bed_id \
	AND d.department_id=db1.department_id) department_bed, \
						 ( /* днів в місяці */ \
						  SELECT max(day(daydate)) month_days \
						  FROM every_day \
						  WHERE month(daydate)  >= :min_month  \
							AND month(daydate)  <= :max_month  \
							AND year(daydate) = 2016 \
						  GROUP BY month(daydate)) month_days) bed_day_plan \
			  GROUP BY department_id ) d \
		LEFT JOIN ( /* поступивші в лікарню */ \
				   SELECT history_department_in, \
						  count(history_department_in) in_clinic \
				   FROM history \
				   WHERE month(history_in)  >= :min_month  \
					 AND month(history_in)  <= :max_month  \
					 AND year(history_in) = :year  \
				   GROUP BY history_department_in) in_clinic ON in_clinic.history_department_in=d.department_id \
		LEFT JOIN ( /* переведені з інши відділення */ \
				   SELECT dh.department_id, \
						  count(dh.department_id) in_dep \
				   FROM \
					 (SELECT dh.* \
					  FROM department_history dh, \
						   history h \
					  WHERE h.history_id=dh.history_id \
						AND h.history_department_in != dh.department_id) dh \
				   WHERE month(dh.department_history_in)  >= :min_month  \
					 AND month(dh.department_history_in)  <= :max_month  \
					 AND year(dh.department_history_in) = :year  \
				   GROUP BY dh.department_id) in_dep ON in_dep.department_id=d.department_id \
		LEFT JOIN ( /* виписані з лікарні */ \
				   SELECT history_department_out, \
						  count(history_department_out) out_clinic \
				   FROM history \
				   WHERE month(history_out) >= :min_month  \
					 AND month(history_out) <= :max_month  \
					 AND year(history_out) = :year  \
				   GROUP BY history_department_out) out_clinic ON out_clinic.history_department_out=d.department_id \
		LEFT JOIN ( /* переведені в інші відділення */ \
				   SELECT dh.department_id, \
						  count(dh.department_id) out_dep \
				   FROM \
					 (SELECT dh.* \
					  FROM department_history dh, \
						   history h \
					  WHERE h.history_id=dh.history_id \
						AND h.history_department_out != dh.department_id) dh \
				   WHERE month(dh.department_history_out) >= :min_month  \
					 AND month(dh.department_history_out) <= :max_month  \
					 AND year(dh.department_history_out) = :year  \
				   GROUP BY dh.department_id) out_dep ON out_dep.department_id=d.department_id \
		LEFT JOIN (  /* переведені в іншу лікарню */ \
				   SELECT history_department_out, \
						  count(history_department_out) out_to_clinic \
				   FROM history h \
				   WHERE result_id=6 \
					 AND month(history_out) >= :min_month  \
					 AND month(history_out) <= :max_month  \
					 AND year(history_out) = :year  \
				   GROUP BY history_department_out) out_to_clinic ON out_to_clinic.history_department_out=d.department_id \
		LEFT JOIN (/* померло */ \
				   SELECT history_department_out, \
						  count(history_department_out) dead \
				   FROM history \
				   WHERE month(history_out) >= :min_month  \
					 AND month(history_out) <= :max_month  \
					 AND year(history_out) = :year  \
					 AND result_id=5 \
				   GROUP BY history_department_out) dead ON dead.history_department_out=d.department_id \
		LEFT JOIN ( /* ліжкодні (сумма лікувались кожного дня) */ \
				   SELECT department_id, \
						  sum(TREAT) bed_day \
				   FROM ( /* лікувалось в день */ \
						 SELECT department_id, \
								daydate, \
								count(daydate) TREAT \
						 FROM department_history dh, \
						   (SELECT * \
							FROM every_day \
							WHERE month(daydate)  >= :min_month  \
							  AND month(daydate)  <= :max_month  \
							  AND year(daydate) = 2016) daydate \
						 WHERE daydate>=dh.department_history_in \
						   AND daydate<=dh.department_history_out \
						 GROUP BY department_id, \
								  daydate) treat_of_day \
				   GROUP BY department_id) bed_day ON bed_day.department_id=d.department_id) d)d \
  UNION \
  SELECT * \
  FROM \
	(SELECT 0 dp_id, \
			'Всього:' department_name, \
					  0 d_bed, \
					  0 d_bed_plan, \
					  0 max_moth_day ) all_, \
	(SELECT count(history_department_in) _in \
	 FROM history \
	 WHERE month(history_in) >= :min_month  \
	   AND month(history_in) <= :max_month  \
	   AND year(history_in) = :year ) in_, \
	(SELECT 0 in_dep) in_dep, \
	(SELECT count(history_department_out) _out \
	 FROM history \
	 WHERE month(history_out) >= :min_month  \
	   AND month(history_out) <= :max_month  \
	   AND year(history_out) = :year ) out_, \
	(SELECT 0 out_dep) out_dep, \
	(SELECT 0 out_to_clinic) out_to_clinic, \
	(SELECT count(history_department_out) dead, \
	   (SELECT 0 l) bed_day, \
	   (SELECT 0 l) TREAT, \
	   (SELECT 0 l) mortality, \
	   0 bed_day_fulfil, \
  0	 bed_occupancy, \
  0	 treat_avg, \
  0	 bed_turnover, \
  0	 bed_turnover2 \
	 FROM history \
	 WHERE month(history_out) >= :min_month  \
	   AND month(history_out) <= :max_month  \
	   AND year(history_out) = :year  \
	   AND result_id=5) dead 

sql.hol1Eih.departmentIcd10Group: \
 SELECT  \
 icd_code_group \
 , ds.icd_code \
 , sum(cnt_all_icd) cnt_all_icd \
 ,   ds.icd_name \
 , count(department_icd_period.icd_id)  icd_id \
 , sum(misto_cnt)  misto_cnt \
 , sum(misto_bed_day)  misto_bed_day \
 , sum(selo_cnt)  selo_cnt \
 , sum(selo_bed_day)  selo_bed_day \
 , sum(referral_has_cnt)  referral_has_cnt \
 , sum(referral_has_bed_day)  referral_has_bed_day \
 , 0  referral_has_icd_id \
 , sum(referral_self_cnt)  referral_self_cnt \
 , sum(referral_self_bed_day)  referral_self_bed_day \
 , 0  referral_self_icd_id \
 , sum(referral_hol_cnt)  referral_hol_cnt \
 , sum(referral_hol_bed_day)  referral_hol_bed_day \
 , 0  referral_hol_icd_id \
 , 0  remove_hol_icd_id \
 , sum(remove_hol_cnt)  remove_hol_cnt \
 , sum(remove_hol_bed_day)  remove_hol_bed_day \
 , 0  remove_true_icd_id \
 , sum(remove_true_cnt)  remove_true_cnt \
 , sum(remove_true_bed_day)  remove_true_bed_day \
 , 0  remove_dead_icd_id \
 , sum(remove_dead_cnt)  remove_dead_cnt \
 , sum(remove_dead_bed_day)  remove_dead_bed_day \
   FROM ( ${sql.hol1Eih.departmentIcd10} ) department_icd_period \
 LEFT JOIN department_icd di ON di.icd_code=icd_code_group AND department_id = :department_id  \
 , icd ds \
 where ds.icd_code=icd_code_group \
 group by icd_code_group \
 order by if(icd_group is not null,icd_group,100), cnt_all_icd desc

sql.hol1Eih.departmentAdress: \
 SELECT  \
 IF(order_group<0,0,IF(order_group=10000,2,1)) misto_raion_other \
 ,  IF(order_group<0,'Wsi misto',IF(order_group=10000,'0','Wsi raion'))  region_name  \
 ,  IF(order_group<0,0,IF(order_group=10000,10001,9999)) order_group \
 , SUM(misto_raion_other_cnt) misto_raion_other_cnt \
 , SUM(bed_day_sum) bed_day_sum \
 , 0  with_misto_raion_other \
 , SUM(with_cnt)  with_cnt \
 , SUM(with_bed_day_sum)  with_bed_day_sum \
 , 0  without_misto_raion_other \
 , sum(without_cnt)  without_cnt \
 , sum(without_bed_day_sum)  without_bed_day_sum \
 , 0  from_dep_misto_raion_other \
 , sum(from_dep_cnt)  from_dep_cnt \
 , sum(from_dep_bed_day_sum)  from_dep_bed_day_sum \
 , 0  to_dep_misto_raion_other \
 , sum(to_dep_cnt)  to_dep_cnt \
 , sum(to_dep_bed_day_sum)  to_dep_bed_day_sum \
 , 0  remove_misto_raion_other \
 , sum(remove_cnt)  remove_cnt \
 , sum(remove_bed_day_sum)  remove_bed_day_sum \
 , 0  dead_misto_raion_other \
 , sum(dead_cnt)  dead_cnt \
 , sum(dead_bed_day_sum)  dead_bed_day_sum \
   FROM ( \
 SELECT * FROM ( \
 SELECT misto_raion_other, \
		region_name, \
		if(misto_raion_other = 10000,misto_raion_other,if(misto_raion_other < 0,-2 ,1)) order_group, \
		count(misto_raion_other) misto_raion_other_cnt, \
		sum(bed_day) bed_day_sum \
 FROM \
   (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
		   if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
		   region_name \
	FROM history h, \
		 patient p, \
		 region r, \
		 department_history dh \
	WHERE department_id = :department_id  \
	  AND year(department_history_out)  = :year  \
	  AND month(department_history_out)  >= :min_month  \
	  AND month(department_history_out)  <= :max_month  \
	  AND dh.history_id=h.history_id \
	  AND p.patient_id=h.patient_id \
	  AND r.region_id = p.region_id ) misto_raion_other \
 GROUP BY misto_raion_other \
 ) misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other with_misto_raion_other, \
		x_cnt with_cnt, \
		x_bed_day_sum with_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(referral) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 referral) misto_raion_other \
 WHERE referral = 4 \
 ) with_misto_raion_other ON with_misto_raion_other.with_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other without_misto_raion_other, \
		x_cnt without_cnt, \
		x_bed_day_sum without_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(referral) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 referral) misto_raion_other \
 WHERE referral = 5 \
 ) without_misto_raion_other ON without_misto_raion_other.without_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other from_dep_misto_raion_other, \
		x_cnt from_dep_cnt, \
		x_bed_day_sum from_dep_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(referral) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 referral) misto_raion_other \
 WHERE referral = 6 \
 ) from_dep_misto_raion_other ON from_dep_misto_raion_other.from_dep_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other to_dep_misto_raion_other, \
		x_cnt to_dep_cnt, \
		x_bed_day_sum to_dep_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(remove) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 remove) misto_raion_other \
 WHERE remove = 7 \
 ) to_dep_misto_raion_other ON to_dep_misto_raion_other.to_dep_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other remove_misto_raion_other, \
		x_cnt remove_cnt, \
		x_bed_day_sum remove_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(remove) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 remove) misto_raion_other \
 WHERE remove = 8 \
 ) remove_misto_raion_other ON remove_misto_raion_other.remove_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other dead_misto_raion_other, \
		x_cnt dead_cnt, \
		x_bed_day_sum dead_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(remove) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 remove) misto_raion_other \
 WHERE remove = 9 \
 ) dead_misto_raion_other ON dead_misto_raion_other.dead_misto_raion_other = misto_raion_other \
 order by order_group , region_name \
 ) misto_raion_other \
 group by order_group \
 union \
 SELECT * FROM ( \
 SELECT misto_raion_other, \
		region_name, \
		if(misto_raion_other = 10000,misto_raion_other,if(misto_raion_other < 0,-2 ,1)) order_group, \
		count(misto_raion_other) misto_raion_other_cnt, \
		sum(bed_day) bed_day_sum \
 FROM \
   (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
		   if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
		   region_name \
	FROM history h, \
		 patient p, \
		 region r, \
		 department_history dh \
	WHERE department_id = :department_id  \
	  AND year(department_history_out)  = :year  \
	  AND month(department_history_out)  >= :min_month  \
	  AND month(department_history_out)  <= :max_month  \
	  AND dh.history_id=h.history_id \
	  AND p.patient_id=h.patient_id \
	  AND r.region_id = p.region_id ) misto_raion_other \
 GROUP BY misto_raion_other \
 ) misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other with_misto_raion_other, \
		x_cnt with_cnt, \
		x_bed_day_sum with_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(referral) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 referral) misto_raion_other \
 WHERE referral = 4 \
 ) with_misto_raion_other ON with_misto_raion_other.with_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other without_misto_raion_other, \
		x_cnt without_cnt, \
		x_bed_day_sum without_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(referral) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 referral) misto_raion_other \
 WHERE referral = 5 \
 ) without_misto_raion_other ON without_misto_raion_other.without_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other from_dep_misto_raion_other, \
		x_cnt from_dep_cnt, \
		x_bed_day_sum from_dep_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(referral) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 referral) misto_raion_other \
 WHERE referral = 6 \
 ) from_dep_misto_raion_other ON from_dep_misto_raion_other.from_dep_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other to_dep_misto_raion_other, \
		x_cnt to_dep_cnt, \
		x_bed_day_sum to_dep_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(remove) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 remove) misto_raion_other \
 WHERE remove = 7 \
 ) to_dep_misto_raion_other ON to_dep_misto_raion_other.to_dep_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other remove_misto_raion_other, \
		x_cnt remove_cnt, \
		x_bed_day_sum remove_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(remove) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 remove) misto_raion_other \
 WHERE remove = 8 \
 ) remove_misto_raion_other ON remove_misto_raion_other.remove_misto_raion_other = misto_raion_other \
 LEFT JOIN ( \
 SELECT misto_raion_other dead_misto_raion_other, \
		x_cnt dead_cnt, \
		x_bed_day_sum dead_bed_day_sum \
 FROM \
   (SELECT misto_raion_other.*, \
		   count(remove) x_cnt, \
		   sum(bed_day) x_bed_day_sum \
	FROM \
	  (SELECT misto_raion_other.*, \
			  if(direct_id=1,5,if(from_department.department_id > 0,6,4)) referral, \
			  if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove \
	   FROM \
		 (SELECT datediff(department_history_out, department_history_in)+1 bed_day, \
				 if(p.district_id=1, if(p.locality_id=1,-2,if(p.locality_id=821,-1,p.region_id)), 10000) misto_raion_other, \
				 direct_id , \
				 h.history_id h_history_id, \
				 h.result_id, \
				 department_history_in, \
				 department_history_out \
		  FROM history h, \
			   patient p, \
			   department_history dh \
		  WHERE department_id = :department_id  \
			AND year(department_history_out)  = :year  \
			AND month(department_history_out)  >= :min_month  \
			AND month(department_history_out)  <= :max_month  \
			AND dh.history_id=h.history_id \
			AND p.patient_id=h.patient_id) misto_raion_other \
	   LEFT JOIN department_history from_department ON h_history_id = from_department.history_id \
	   AND TIMESTAMPDIFF(SECOND, from_department.department_history_out, misto_raion_other.department_history_in) = 1 \
	   LEFT JOIN department_history remove_to ON h_history_id = remove_to.history_id \
	   AND TIMESTAMPDIFF(SECOND, misto_raion_other.department_history_out,remove_to.department_history_in) = 1) misto_raion_other \
	GROUP BY misto_raion_other, \
			 remove) misto_raion_other \
 WHERE remove = 9 \
 ) dead_misto_raion_other ON dead_misto_raion_other.dead_misto_raion_other = misto_raion_other \
 ORDER BY order_group , region_name 

sql.hol1Eih.departmentIcd10: \
 SELECT substr(all_icd10_of_department.icd_code,1,3) icd_code_group, all_icd10_of_department.*, misto_cnt, misto_bed_day, selo_cnt, selo_bed_day \
 , referral_has.* , referral_self.* , referral_hol.*  \
 , remove_hol.* , remove_true.*, remove_dead.* \
 FROM ( \
 SELECT icd_code, \
		count(icd_code) cnt_all_icd, \
		icd_name , icd_id \
		FROM \
   (SELECT icd.*, dh.history_id \
	FROM history_diagnos hd, department_history dh, icd icd \
	WHERE hd.history_id=dh.history_id \
	  AND department_id = :department_id  \
	  AND diagnos_id=3 \
	  AND hd.icd_id=icd.icd_id) all_department_history_with_diagnose \
 GROUP BY icd_code) all_icd10_of_department \
 LEFT JOIN ( \
 SELECT locality_type misto, \
		count(locality_type) misto_cnt, \
		icd_id, \
		icd_code, \
		sum(bed_day) misto_bed_day \
 FROM \
   (SELECT * \
	FROM \
	  (SELECT datediff(department_history_out, department_history_in)+1 bed_day, department_history_period.*, \
			  all_department_history_with_icd10.*, \
			  h.patient_id patient_id_h \
	   FROM history h, \
		 (SELECT * \
		  FROM department_history \
		  WHERE department_id = :department_id  \
			AND YEAR(department_history_out)  = :year  \
			AND MONTH(department_history_out)  >= :min_month  \
			AND MONTH(department_history_out)  <= :max_month ) department_history_period \
 	LEFT JOIN ( \
 	SELECT icd.*, \
				 dh.history_id h2_id \
		  FROM history_diagnos hd, \
			   department_history dh, \
			   icd icd \
		  WHERE hd.history_id=dh.history_id \
			AND department_id = :department_id  \
			AND diagnos_id=3 \
			AND hd.icd_id=icd.icd_id) all_department_history_with_icd10 ON all_department_history_with_icd10.h2_id=department_history_period.history_id \
	   WHERE department_history_period.history_id= h.history_id) history_icd10, \
	  (SELECT patient_id patient_id_p, \
			  locality_id locality_id_p \
	   FROM patient) p, \
		 locality l \
	WHERE patient_id_p=patient_id_h \
	  AND locality_id_p=l.locality_id) misto_selo \
 GROUP BY icd_id, \
		  locality_type) misto on all_icd10_of_department.icd_id=misto.icd_id and misto=1 \
 LEFT JOIN ( \
 SELECT locality_type selo_misto, \
		count(locality_type) selo_cnt, \
		icd_id, \
		icd_code, \
		sum(bed_day) selo_bed_day \
 FROM \
   (SELECT * \
	FROM \
	  (SELECT datediff(department_history_out, department_history_in)+1 bed_day, department_history_period.*, \
			  all_department_history_with_icd10.*, \
			  h.patient_id patient_id_h \
	   FROM history h, \
		 (SELECT * \
		  FROM department_history \
		  WHERE department_id = :department_id  \
			AND YEAR(department_history_out)  = :year  \
			AND MONTH(department_history_out)  >= :min_month  \
			AND MONTH(department_history_out)  <= :max_month ) department_history_period \
	   LEFT JOIN \
		 (SELECT icd.*, \
				 dh.history_id h2_id \
		  FROM history_diagnos hd, \
			   department_history dh, \
			   icd icd \
		  WHERE hd.history_id=dh.history_id \
			AND department_id = :department_id  \
			AND diagnos_id=3 \
			AND hd.icd_id=icd.icd_id) all_department_history_with_icd10 ON all_department_history_with_icd10.h2_id=department_history_period.history_id  \
	   WHERE department_history_period.history_id= h.history_id) history_icd10, \
	  (SELECT patient_id patient_id_p, \
			  locality_id locality_id_p \
	   FROM patient) p, \
		 locality l \
	WHERE patient_id_p=patient_id_h \
	  AND locality_id_p=l.locality_id) misto_selo \
 GROUP BY icd_id, \
		  locality_type) selo on all_icd10_of_department.icd_id=selo.icd_id and selo_misto=0 \
 LEFT JOIN ( \
 SELECT referral_cnt  referral_has_cnt, referral_bed_day_sum referral_has_bed_day, icd_id referral_has_icd_id  \
 FROM \
   (SELECT referral.*, \
		   COUNT(referral) referral_cnt, \
		   SUM(referral_bed_day) referral_bed_day_sum \
	FROM \
	  (SELECT icd_id, \
			  icd_code, \
			  IF(dr.direct_id=1,1,IF(dhf.department_id > 0,99999,0)) referral, \
			  datediff(history_icd10.department_history_out, history_icd10.department_history_in)+1 referral_bed_day \
	   FROM \
		 (SELECT department_history_period.*, \
				 all_department_history_with_icd10.*, \
				 h.direct_id \
		  FROM patient p, \
			   history h, \
			(SELECT * \
			 FROM department_history \
			 WHERE department_id = :department_id  \
			   AND YEAR(department_history_out)  = :year  \
			   AND MONTH(department_history_out)  >= :min_month  \
			   AND MONTH(department_history_out)  <= :max_month ) department_history_period \
		  LEFT JOIN \
			(SELECT icd.icd_id, \
					icd.icd_code, \
					icd.icd_name, \
					dh.history_id h2_id \
			 FROM history_diagnos hd, \
				  department_history dh, \
				  icd icd \
			 WHERE hd.history_id=dh.history_id \
			   AND department_id = :department_id  \
			   AND diagnos_id=3 \
			   AND hd.icd_id=icd.icd_id) all_department_history_with_icd10 ON all_department_history_with_icd10.h2_id=department_history_period.history_id \
		  WHERE p.patient_id=h.patient_id \
			AND department_history_period.history_id= h.history_id) history_icd10 \
	   LEFT JOIN department_history dhf ON history_icd10.h2_id = dhf.history_id \
	   AND TIMESTAMPDIFF(SECOND,dhf.department_history_out, history_icd10.department_history_in) = 1, \
																								   direct dr \
	   WHERE dr.direct_id=history_icd10.direct_id ) referral \
	GROUP BY icd_code, \
			 referral) referral \
 WHERE referral=1) referral_has on referral_has_icd_id = all_icd10_of_department.icd_id \
 LEFT JOIN ( \
 SELECT referral_cnt  referral_self_cnt, referral_bed_day_sum referral_self_bed_day, icd_id referral_self_icd_id  \
 FROM \
   (SELECT referral.*, \
		   COUNT(referral) referral_cnt, \
		   SUM(referral_bed_day) referral_bed_day_sum \
	FROM \
	  (SELECT icd_id, \
			  icd_code, \
			  IF(dr.direct_id=1,1,IF(dhf.department_id > 0,99999,0)) referral, \
			  datediff(history_icd10.department_history_out, history_icd10.department_history_in)+1 referral_bed_day \
	   FROM \
		 (SELECT department_history_period.*, \
				 all_department_history_with_icd10.*, \
				 h.direct_id \
		  FROM patient p, \
			   history h, \
			(SELECT * \
			 FROM department_history \
			 WHERE department_id = :department_id  \
			   AND YEAR(department_history_out)  = :year  \
			   AND MONTH(department_history_out)  >= :min_month  \
			   AND MONTH(department_history_out)  <= :max_month ) department_history_period \
		  LEFT JOIN \
			(SELECT icd.icd_id, \
					icd.icd_code, \
					icd.icd_name, \
					dh.history_id h2_id \
			 FROM history_diagnos hd, \
				  department_history dh, \
				  icd icd \
			 WHERE hd.history_id=dh.history_id \
			   AND department_id = :department_id  \
			   AND diagnos_id=3 \
			   AND hd.icd_id=icd.icd_id) all_department_history_with_icd10 ON all_department_history_with_icd10.h2_id=department_history_period.history_id \
		  WHERE p.patient_id=h.patient_id \
			AND department_history_period.history_id= h.history_id) history_icd10 \
	   LEFT JOIN department_history dhf ON history_icd10.h2_id = dhf.history_id \
	   AND TIMESTAMPDIFF(SECOND,dhf.department_history_out, history_icd10.department_history_in) = 1, \
																								   direct dr \
	   WHERE dr.direct_id=history_icd10.direct_id ) referral \
	GROUP BY icd_code, \
			 referral) referral \
 WHERE referral=0) referral_self on referral_self_icd_id = all_icd10_of_department.icd_id \
 LEFT JOIN ( \
 SELECT referral_cnt  referral_hol_cnt, referral_bed_day_sum referral_hol_bed_day, icd_id referral_hol_icd_id  \
 FROM \
   (SELECT referral.*, \
		   COUNT(referral) referral_cnt, \
		   SUM(referral_bed_day) referral_bed_day_sum \
	FROM \
	  (SELECT icd_id, \
			  icd_code, \
			  IF(dr.direct_id=1,1,IF(dhf.department_id > 0,99999,0)) referral, \
			  datediff(history_icd10.department_history_out, history_icd10.department_history_in)+1 referral_bed_day \
	   FROM \
		 (SELECT department_history_period.*, \
				 all_department_history_with_icd10.*, \
				 h.direct_id \
		  FROM patient p, \
			   history h, \
			(SELECT * \
			 FROM department_history \
			 WHERE department_id = :department_id  \
			   AND YEAR(department_history_out)  = :year  \
			   AND MONTH(department_history_out)  >= :min_month  \
			   AND MONTH(department_history_out)  <= :max_month ) department_history_period \
		  LEFT JOIN \
			(SELECT icd.icd_id, \
					icd.icd_code, \
					icd.icd_name, \
					dh.history_id h2_id \
			 FROM history_diagnos hd, \
				  department_history dh, \
				  icd icd \
			 WHERE hd.history_id=dh.history_id \
			   AND department_id = :department_id  \
			   AND diagnos_id=3 \
			   AND hd.icd_id=icd.icd_id) all_department_history_with_icd10 ON all_department_history_with_icd10.h2_id=department_history_period.history_id \
		  WHERE p.patient_id=h.patient_id \
			AND department_history_period.history_id= h.history_id) history_icd10 \
	   LEFT JOIN department_history dhf ON history_icd10.h2_id = dhf.history_id \
	   AND TIMESTAMPDIFF(SECOND,dhf.department_history_out, history_icd10.department_history_in) = 1, \
																								   direct dr \
	   WHERE dr.direct_id=history_icd10.direct_id ) referral \
	GROUP BY icd_code, \
			 referral) referral \
 WHERE referral>1) referral_hol on referral_hol_icd_id = all_icd10_of_department.icd_id \
 LEFT JOIN ( \
 SELECT remove_icd_id remove_hol_icd_id, remove_cnt_x  remove_hol_cnt, remove_bed_day_x remove_hol_bed_day FROM ( \
 SELECT icd_id remove_icd_id,icd_code remove_icd_code, remove, count(remove) remove_cnt_x, sum(remove_bed_day) remove_bed_day_x \
 FROM \
   (SELECT history_icd10.icd_id, \
		   history_icd10.icd_code, \
		   if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove, \
		   datediff(history_icd10.department_history_out, history_icd10.department_history_in)+1 remove_bed_day \
	FROM \
	  (SELECT department_history_period.*, \
			  all_department_history_with_icd10.*, \
			  h.direct_id, \
			  h.result_id \
	   FROM patient p, \
			history h, \
		 (SELECT * \
		  FROM department_history \
		  WHERE department_id = :department_id  \
			AND YEAR(department_history_out)  = :year  \
			AND MONTH(department_history_out)  >= :min_month  \
			AND MONTH(department_history_out)  <= :max_month ) department_history_period \
	   LEFT JOIN \
		 (SELECT icd.icd_id, \
				 icd.icd_code, \
				 icd.icd_name, \
				 dh.history_id h2_id \
		  FROM history_diagnos hd, \
			   department_history dh, \
			   icd icd \
		  WHERE hd.history_id=dh.history_id \
			AND department_id = :department_id  \
			AND diagnos_id=3 \
			AND hd.icd_id=icd.icd_id) all_department_history_with_icd10 ON all_department_history_with_icd10.h2_id=department_history_period.history_id \
	   WHERE p.patient_id=h.patient_id \
		 AND department_history_period.history_id= h.history_id) history_icd10 \
	LEFT JOIN department_history remove_to ON history_icd10.history_id = remove_to.history_id \
	AND TIMESTAMPDIFF(SECOND,history_icd10.department_history_out,remove_to.department_history_in) = 1 \
	) remove \
	GROUP BY icd_id, remove) remove \
	  WHERE remove = 7 \
 ) remove_hol on remove_hol_icd_id = all_icd10_of_department.icd_id \
 LEFT JOIN ( \
 SELECT remove_icd_id remove_true_icd_id, remove_cnt_x  remove_true_cnt, remove_bed_day_x remove_true_bed_day FROM ( \
 SELECT icd_id remove_icd_id,icd_code remove_icd_code, remove, count(remove) remove_cnt_x, sum(remove_bed_day) remove_bed_day_x \
 FROM \
   (SELECT history_icd10.icd_id, \
		   history_icd10.icd_code, \
		   if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove, \
		   datediff(history_icd10.department_history_out, history_icd10.department_history_in)+1 remove_bed_day \
	FROM \
	  (SELECT department_history_period.*, \
			  all_department_history_with_icd10.*, \
			  h.direct_id, \
			  h.result_id \
	   FROM patient p, \
			history h, \
		 (SELECT * \
		  FROM department_history \
		  WHERE department_id = :department_id  \
			AND YEAR(department_history_out)  = :year  \
			AND MONTH(department_history_out)  >= :min_month  \
			AND MONTH(department_history_out)  <= :max_month ) department_history_period \
	   LEFT JOIN \
		 (SELECT icd.icd_id, \
				 icd.icd_code, \
				 icd.icd_name, \
				 dh.history_id h2_id \
		  FROM history_diagnos hd, \
			   department_history dh, \
			   icd icd \
		  WHERE hd.history_id=dh.history_id \
			AND department_id = :department_id  \
			AND diagnos_id=3 \
			AND hd.icd_id=icd.icd_id) all_department_history_with_icd10 ON all_department_history_with_icd10.h2_id=department_history_period.history_id \
	   WHERE p.patient_id=h.patient_id \
		 AND department_history_period.history_id= h.history_id) history_icd10 \
	LEFT JOIN department_history remove_to ON history_icd10.history_id = remove_to.history_id \
	AND TIMESTAMPDIFF(SECOND,history_icd10.department_history_out,remove_to.department_history_in) = 1 \
	) remove \
	GROUP BY icd_id, remove) remove \
	  WHERE remove = 8 \
 ) remove_true on remove_true_icd_id = all_icd10_of_department.icd_id \
 LEFT JOIN ( \
 SELECT remove_icd_id remove_dead_icd_id, remove_cnt_x  remove_dead_cnt, remove_bed_day_x remove_dead_bed_day FROM ( \
 SELECT icd_id remove_icd_id,icd_code remove_icd_code, remove, count(remove) remove_cnt_x, sum(remove_bed_day) remove_bed_day_x \
 FROM \
   (SELECT history_icd10.icd_id, \
		   history_icd10.icd_code, \
		   if(remove_to.history_id>0,7,if(result_id=5,9,8)) remove, \
		   datediff(history_icd10.department_history_out, history_icd10.department_history_in)+1 remove_bed_day \
	FROM \
	  (SELECT department_history_period.*, \
			  all_department_history_with_icd10.*, \
			  h.direct_id, \
			  h.result_id \
	   FROM patient p, \
			history h, \
		 (SELECT * \
		  FROM department_history \
		  WHERE department_id = :department_id  \
			AND YEAR(department_history_out)  = :year  \
			AND MONTH(department_history_out)  >= :min_month  \
			AND MONTH(department_history_out)  <= :max_month ) department_history_period \
	   LEFT JOIN \
		 (SELECT icd.icd_id, \
				 icd.icd_code, \
				 icd.icd_name, \
				 dh.history_id h2_id \
		  FROM history_diagnos hd, \
			   department_history dh, \
			   icd icd \
		  WHERE hd.history_id=dh.history_id \
			AND department_id = :department_id  \
			AND diagnos_id=3 \
			AND hd.icd_id=icd.icd_id) all_department_history_with_icd10 ON all_department_history_with_icd10.h2_id=department_history_period.history_id \
	   WHERE p.patient_id=h.patient_id \
		 AND department_history_period.history_id= h.history_id) history_icd10 \
	LEFT JOIN department_history remove_to ON history_icd10.history_id = remove_to.history_id \
	AND TIMESTAMPDIFF(SECOND,history_icd10.department_history_out,remove_to.department_history_in) = 1 \
	) remove \
	GROUP BY icd_id, remove) remove \
	  WHERE remove = 9 \
 ) remove_dead on remove_dead_icd_id = all_icd10_of_department.icd_id 
			
			
			
